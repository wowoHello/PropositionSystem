<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>角色與權限管理 - CWT 命題工作平臺</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <style>
    /* --- 1. 動態切換器樣式 (Sliding Segmented Control) --- */
    .nav-segment-container {
      position: relative;
      display: flex;
      background-color: #f1f5f9;
      padding: 4px;
      border-radius: 50rem;
      border: 1px solid #e2e8f0;
      width: fit-content;
    }

    .nav-segment-indicator {
      position: absolute;
      top: 4px;
      bottom: 4px;
      left: 4px;
      width: calc(50% - 4px);
      background-color: white;
      border-radius: 50rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }

    .nav-segment-item {
      flex: 1;
      position: relative;
      z-index: 2;
      padding: 0.5rem 1rem;
      font-weight: 600;
      font-size: 0.95rem;
      color: #64748b;
      text-align: center;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: color 0.3s ease;
      border-radius: 50rem;
      white-space: nowrap;
    }

    .nav-segment-item.active {
      color: #2563eb;
    }

    /* --- 2. 權限設定卡片 --- */
    .permission-item-card {
      background-color: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem;
      display: flex;
      align-items: center;
      /* 垂直置中 */
      gap: 1rem;
      /* 元件間距 */
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    .permission-item-card:hover {
      border-color: #94a3b8;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      transform: translateY(-2px);
    }

    /* 選中(開啟)狀態 */
    .permission-item-card.active {
      background-color: #f0f9ff;
      /* 淺藍背景 */
      border-color: #3b82f6;
      /* 藍色邊框 */
      box-shadow: 0 0 0 1px #3b82f6 inset;
      /* 內陰影加強邊框感 */
    }

    .permission-item-card.checked {
      border-color: #3b82f6;
      background-color: #eff6ff;
      box-shadow: 0 0 0 1px #3b82f6 inset;
    }

    /* 左側圖示區塊樣式 */
    .perm-icon-box {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
      transition: all 0.2s ease;
    }

    /* 文字區塊 */
    .perm-text {
      flex-grow: 1;
    }

    .perm-title {
      font-weight: 700;
      color: #334155;
      margin-bottom: 2px;
      font-size: 1rem;
    }

    .perm-desc {
      font-size: 0.85rem;
      color: #64748b;
      line-height: 1.4;
    }

    /* 開關樣式微調 */
    .custom-switch-lg {
      width: 3rem !important;
      height: 1.5rem !important;
      cursor: pointer;
      margin-left: auto;
      /* 強制靠右 */
    }

    .custom-switch-lg {
      width: 3.2rem !important;
      height: 1.6rem !important;
      cursor: pointer;
      margin-left: 1rem;
    }

    /* --- 3. 角色卡片 (v1) --- */
    .role-card-v1 {
      position: relative;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 1.75rem;
      height: 100%;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      overflow: hidden;
    }

    .role-card-v1::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--card-color), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .role-card-v1:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
      border-color: var(--card-color);
    }

    .role-card-v1:hover::before {
      opacity: 1;
    }

    .role-card-v1 .icon-wrapper {
      width: 64px;
      height: 64px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin-bottom: 1.25rem;
      background: var(--card-bg);
      color: var(--card-color);
      transition: transform 0.3s ease;
    }

    .role-card-v1:hover .icon-wrapper {
      transform: scale(1.1) rotate(5deg);
    }

    .role-card-v1 .role-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 0.5rem;
    }

    .role-card-v1 .role-description {
      font-size: 0.875rem;
      color: #64748b;
      line-height: 1.6;
      margin-bottom: 1.25rem;
      min-height: 3rem;
    }

    .role-card-v1 .stats-row {
      display: flex;
      gap: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid #f1f5f9;
    }

    .role-card-v1 .stat-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .role-card-v1 .stat-label {
      font-size: 0.75rem;
      color: #94a3b8;
      font-weight: 500;
    }

    .role-card-v1 .stat-value {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--card-color);
    }

    .role-card-v1 .action-button {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s ease;
      opacity: 0;
    }

    .role-card-v1:hover .action-button {
      opacity: 1;
    }

    .role-card-v1 .action-button:hover {
      background: var(--card-bg);
      color: var(--card-color);
      border-color: var(--card-color);
    }

    /* --- 4. 新增角色卡片 --- */
    .add-role-card {
      border: 2px dashed #cbd5e1;
      border-radius: 16px;
      background: #f8fafc;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 2rem;
      height: 100%;
      min-height: 300px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .add-role-card:hover {
      border-color: #3b82f6;
      background: #eff6ff;
      transform: translateY(-4px);
    }

    .add-role-card .icon-plus {
      width: 64px;
      height: 64px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      color: #94a3b8;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .add-role-card:hover .icon-plus {
      color: #3b82f6;
      transform: rotate(90deg);
    }

    .add-role-card .add-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: #475569;
      margin-bottom: 0.5rem;
    }

    .add-role-card .add-description {
      font-size: 0.875rem;
      color: #94a3b8;
      text-align: center;
    }

    /* --- 5. 顏色主題 --- */
    .theme-admin {
      --card-color: #d97706;
      --card-bg: #fef3c7;
    }

    .theme-teacher {
      --card-color: #059669;
      --card-bg: #d1fae5;
    }

    .theme-reviewer {
      --card-color: #2563eb;
      --card-bg: #dbeafe;
    }

    .theme-staff {
      --card-color: #7c3aed;
      --card-bg: #ede9fe;
    }

    .theme-custom1 {
      --card-color: #7c3aed;
      --card-bg: #ede9fe;
    }

    .theme-custom2 {
      --card-color: #e11d48;
      --card-bg: #fee2e2;
    }

    /* --- 6. Icon 選擇器 --- */
    .icon-picker-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
      gap: 0.5rem;
      max-height: 300px;
      overflow-y: auto;
      padding: 1rem;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .icon-option {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1.5rem;
    }

    .icon-option:hover {
      border-color: #3b82f6;
      background: #eff6ff;
      transform: scale(1.1);
    }

    .icon-option.selected {
      border-color: #3b82f6;
      background: #eff6ff;
      box-shadow: 0 0 0 2px #3b82f6 inset;
    }

    .icon-preview {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      margin: 0 auto 1rem;
      background-color: var(--card-bg, #f3f4f6);
      color: var(--card-color, #6b7280);
    }

    .multi-role-badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    /* 專案管理頁籤專用樣式 */

    /* 自訂捲軸 (讓左側列表更美觀) */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    /* --- 修正列表過短時的視覺問題 --- */

    /* --- 列表樣式優化 (Wrapper 版本) --- */

    /* --- 列表樣式優化 (Wrapper 版本) --- */

    /* 1. 列表本體背景設為白色 */
    #projectListContainer {
      background-color: #fff;
    }

    /* 2. 確保列表最後一個項目有底線 */
    /* 這條線是用來區隔「白色列表」與「下方灰色空白區」的重要界線 */
    #projectListContainer .list-group-item:last-child {
      border-bottom: 1px solid rgba(0, 0, 0, 0.125) !important;
    }

    /* 3. 列表項目互動效果 */
    #projectListContainer .list-group-item {
      border-left: 4px solid transparent;
      /* 預留左側邊框位置 */
      transition: all 0.2s ease;
    }

    #projectListContainer .list-group-item:hover {
      background-color: #f8f9fa;
      /* Hover 淺灰 */
    }

    /* Active 狀態樣式 (保持原本設計) */
    #projectListContainer .list-group-item.active {
      background-color: #2563eb !important;
      border-color: #2563eb !important;
      /* 左側邊框 */
      color: white !important;
      z-index: 2;
      /* 確保浮在最上層 */
    }

    /* 確保 Active 狀態下的文字顏色正確 */
    #projectListContainer .list-group-item.active h6 {
      color: white !important;
    }

    #projectListContainer .list-group-item.active small,
    #projectListContainer .list-group-item.active i {
      color: rgba(255, 255, 255, 0.8) !important;
    }

    #projectListContainer .list-group-item.active .badge.bg-primary {
      background-color: white !important;
      color: #2563eb !important;
    }

    /* --- 8 Permission Tags Styling --- */
    .badge-tag-base {
      font-weight: 500;
      border: 1px solid;
      padding: 0.35em 0.65em;
      border-radius: 6px;
      /* Slightly more rounded */
      font-size: 0.75rem;
      /* Or 0.8rem */
      display: inline-flex;
      align-items: center;
      margin-right: 4px;
      /* Space between tags */
      margin-bottom: 4px;
      white-space: nowrap;
    }

    /* 1. 今日提醒 (Reminder) - Alert/Red */
    .tag-reminder {
      background-color: #fef2f2;
      color: #b91c1c;
      border-color: #fecaca;
    }

    /* 2. 命題儀表板 (Dashboard) - Blue/Primary */
    .tag-dashboard {
      background-color: #eff6ff;
      color: #1d4ed8;
      border-color: #bfdbfe;
    }

    /* 3. 我的命題任務 (My Tasks) - Green */
    .tag-mytask {
      background-color: #f0fdf4;
      color: #15803d;
      border-color: #bbf7d0;
    }

    /* 4. 審題清單 (Review List) - Cyan/Info */
    .tag-review {
      background-color: #ecfeff;
      color: #0e7490;
      border-color: #a5f3fc;
    }

    /* 5. 系統公告/使用說明 (Announcement) - Yellow/Warning */
    .tag-notice {
      background-color: #fffbeb;
      color: #b45309;
      border-color: #fde68a;
    }

    /* 6. 教師管理系統 (people) - Teal */
    .tag-teacher {
      background-color: #f0fdfa;
      color: #0f766e;
      border-color: #99f6e4;
    }

    /* 7. 命題專案管理 (Project) - Indigo */
    .tag-project {
      background-color: #eef2ff;
      color: #4338ca;
      border-color: #c7d2fe;
    }

    /* 8. 角色與權限管理 (Role) - Purple/Gray */
    .tag-role {
      background-color: #faf5ff;
      color: #7e22ce;
      border-color: #e9d5ff;
    }
  </style>
</head>

<body>
  <nav class="top-navbar">
    <div class="container-fluid px-4">
      <div class="row align-items-center">
        <div class="col-3">
          <a href="index.html" class="navbar-brand">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
            </svg>
            CWT 命題工作平臺
          </a>
        </div>
        <!-- 中間：專案切換器 -->
        <div class="col-6 d-flex justify-content-center">
          <div class="project-switcher">
            <div class="project-display" id="projectToggle">
              <div class="project-info">
                <div class="project-year" id="currentProjectYear">
                  2024年度
                </div>
                <div class="project-name" id="currentProjectName">
                  進行中梯次範例一
                </div>
              </div>
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
              </svg>
            </div>

            <div class="project-dropdown" id="projectDropdown">
              <div class="dropdown-header">
                <span>切換專案</span>
                <button class="close-btn" id="closeDropdown">
                  <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path
                      d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                  </svg>
                </button>
              </div>

              <div class="project-search">
                <input type="text" placeholder="搜尋專案名稱..." id="projectSearchInput" />
              </div>

              <div class="project-list" id="projectList">
                <div class="project-category">進行中 (3)</div>

                <div class="project-item active" data-project-id="1" data-year="2024" data-name="進行中梯次範例一"
                  data-role="admin">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例一
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2024/12/31</span>
                    </div>
                  </div>
                  <span class="role-badge role-admin">系統管理員</span>
                </div>

                <div class="project-item" data-project-id="2" data-year="2024" data-name="進行中梯次範例二"
                  data-role="reviewer">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例二
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2024/11/15</span>
                    </div>
                  </div>
                  <span class="role-badge role-reviewer">審題委員</span>
                </div>

                <div class="project-item" data-project-id="3" data-year="2024" data-name="進行中梯次範例三" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例三
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2025/01/20</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-category">已結束 (5)</div>

                <div class="project-item" data-project-id="4" data-year="2023" data-name="已結束梯次範例一" data-role="admin">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例一
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-admin">系統管理員</span>
                </div>

                <div class="project-item" data-project-id="5" data-year="2023" data-name="已結束梯次範例二" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例二
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-item" data-project-id="6" data-year="2023" data-name="已結束梯次範例三"
                  data-role="reviewer">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例三
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-reviewer">審題委員</span>
                </div>

                <div class="project-item" data-project-id="7" data-year="2022" data-name="已結束梯次範例四" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例四
                    </div>
                    <div class="project-item-meta">
                      <span>2022年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-item" data-project-id="8" data-year="2022" data-name="已結束梯次範例五" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例五
                    </div>
                    <div class="project-item-meta">
                      <span>2022年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 右側：使用者資訊 -->
        <div class="col-3">
          <div class="user-section">
            <div class="user-info">
              <div class="user-avatar">沈</div>
              <span class="user-name">沈雅茹</span>
              <span class="role-badge role-admin" id="currentUserRole">系統管理員</span>
            </div>
            <a href="index.html" class="btn btn-sm btn-light fw-bold text-primary px-3">登出</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="breadcrumb-bar">
    <div class="container-fluid px-4">
      <a href="firstpage.html" class="breadcrumb-item-link">首頁</a>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-current">角色與權限管理</span>
    </div>
  </div>

  <div class="main-content">
    <div class="container px-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h3 fw-bold text-dark mb-1">角色與權限管理</h1>
          <p class="text-secondary small mb-0">
            管理系統使用者帳號、指派身分，以及定義各身分的存取權限。
          </p>
        </div>
        <div class="nav-segment-container">
          <div class="nav-segment-indicator" id="segmentIndicator"></div>
          <button class="nav-segment-item active" onclick="switchTab(0, '#pills-users')">
            人員帳號管理
          </button>
          <button class="nav-segment-item" onclick="switchTab(1, '#pills-roles')">
            管理角色權限
          </button>
        </div>
      </div>

      <div class="tab-content" id="pills-tabContent">
        <!--  ==================
                人員帳號管理區塊 
                ================== -->
        <div class="tab-pane fade show active" id="pills-users" role="tabpanel">
          <div class="alert alert-primary d-flex align-items-center border-0 bg-opacity-10 mb-4" role="alert">
            <i class="bi bi-info-circle-fill text-primary me-3 fs-5"></i>
            <div>
              <strong>帳號管理說明：</strong>
              此處僅管理使用者的「基本登入帳號」與「系統存取狀態」。<br />
              若需指派命題或審題工作，請至
              <strong>[命題專案管理]</strong> 頁籤進行設定。
            </div>
          </div>

          <div class="card border-0 shadow-sm rounded-4">
            <div class="card-body p-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex gap-2">
                  <div class="input-group" style="width: 300px">
                    <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
                    <input type="text" class="form-control border-start-0 ps-0" placeholder="搜尋姓名、Email 或單位..." />
                  </div>
                  <button class="btn btn-primary">查詢</button>
                </div>
                <button class="btn btn-success fw-bold px-3 shadow-sm" onclick="openAddUserModal()">
                  <i class="bi bi-person-plus-fill me-1"></i> 新增使用者
                </button>
              </div>

              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead class="bg-light text-secondary small">
                    <tr>
                      <th width="60" class="ps-3">序號</th>
                      <th>使用者姓名</th>
                      <th>使用者帳號</th>
                      <th>電子信箱</th>
                      <th>最後登入</th>
                      <th>帳號狀態</th>
                      <th class="text-center pe-3">操作</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="ps-3">1</td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex justify-content-center align-items-center me-2 fw-bold"
                            style="width: 36px; height: 36px">
                            陳
                          </div>
                          <span class="fw-bold text-dark">陳言綸</span>
                        </div>
                      </td>
                      <td class="font-monospace text-secondary">
                        guray_chen
                      </td>
                      <td>
                        <div class="text-dark small">test@mail.com</div>
                      </td>
                      <td class="text-secondary small">
                        2024/01/15<br />14:30
                      </td>
                      <td>
                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill">啟用中</span>
                      </td>
                      <td class="text-center pe-3">
                        <button class="btn btn-sm btn-outline-secondary border-0 btn-edit-user"
                          onclick="openEditUserModal(0)">
                          <i class="bi bi-pencil-square"></i>
                        </button>
                        <div class="btn-group">
                          <button class="btn btn-sm btn-outline-secondary border-0" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                            <li>
                              <a class="dropdown-item" href="#">重設密碼</a>
                            </li>
                            <li>
                              <a class="dropdown-item text-danger" href="#">停用帳號</a>
                            </li>
                          </ul>
                        </div>
                      </td>
                    </tr>

                    <tr>
                      <td class="ps-3">2</td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="bg-warning bg-opacity-10 text-warning rounded-circle d-flex justify-content-center align-items-center me-2 fw-bold"
                            style="width: 36px; height: 36px">
                            姚
                          </div>
                          <span class="fw-bold text-dark">姚春如</span>
                        </div>
                      </td>
                      <td class="font-monospace text-secondary">
                        carol_yao
                      </td>
                      <td>
                        <div class="text-dark small">test@mail.com</div>
                      </td>
                      <td class="text-secondary small">
                        2024/01/18<br />09:15
                      </td>
                      <td>
                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill">啟用中</span>
                      </td>
                      <td class="text-center pe-3">
                        <button class="btn btn-sm btn-outline-secondary border-0 btn-edit-user"
                          onclick="openEditUserModal(1)">
                          <i class="bi bi-pencil-square"></i>
                        </button>
                        <div class="btn-group">
                          <button class="btn btn-sm btn-outline-secondary border-0" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                            <li>
                              <a class="dropdown-item" href="#">重設密碼</a>
                            </li>
                            <li>
                              <a class="dropdown-item text-danger" href="#">停用帳號</a>
                            </li>
                          </ul>
                        </div>
                      </td>
                    </tr>

                    <tr class="bg-light">
                      <td class="ps-3">3</td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="bg-secondary bg-opacity-10 text-secondary rounded-circle d-flex justify-content-center align-items-center me-2 fw-bold"
                            style="width: 36px; height: 36px">
                            林
                          </div>
                          <span class="fw-bold text-secondary">林洪正</span>
                        </div>
                      </td>
                      <td class="font-monospace text-secondary">
                        jacky_lin
                      </td>
                      <td>
                        <div class="text-secondary small">test@mail.com</div>
                      </td>
                      <td class="text-secondary small">
                        2023/11/05<br />10:00
                      </td>
                      <td>
                        <span class="badge bg-danger bg-opacity-10 text-danger rounded-pill">已停用</span>
                      </td>
                      <td class="text-center pe-3">
                        <button class="btn btn-sm btn-outline-secondary border-0 btn-edit-user"
                          onclick="openEditUserModal(4)">
                          <i class="bi bi-pencil-square"></i>
                        </button>
                        <div class="btn-group">
                          <button class="btn btn-sm btn-outline-secondary border-0" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                            <li>
                              <a class="dropdown-item" href="#">啟用帳號</a>
                            </li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td class="ps-3">4</td>
                      <td>
                        <div class="d-flex align-items-center">
                          <div
                            class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex justify-content-center align-items-center me-2 fw-bold"
                            style="width: 36px; height: 36px">
                            沈
                          </div>
                          <span class="fw-bold text-dark">沈雅茹</span>
                        </div>
                      </td>
                      <td class="font-monospace text-secondary">
                        lillian_shen
                      </td>
                      <td>
                        <div class="text-dark small">test@mail.com</div>
                      </td>
                      <td class="text-secondary small">
                        2024/01/15<br />14:30
                      </td>
                      <td>
                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill">啟用中</span>
                      </td>
                      <td class="text-center pe-3">
                        <button class="btn btn-sm btn-outline-secondary border-0 btn-edit-user"
                          onclick="openEditUserModal(0)">
                          <i class="bi bi-pencil-square"></i>
                        </button>
                        <div class="btn-group">
                          <button class="btn btn-sm btn-outline-secondary border-0" data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots-vertical"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                            <li>
                              <a class="dropdown-item" href="#">重設密碼</a>
                            </li>
                            <li>
                              <a class="dropdown-item text-danger" href="#">停用帳號</a>
                            </li>
                          </ul>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <nav class="mt-4 d-flex justify-content-center">
                <ul class="pagination pagination-sm">
                  <li class="page-item disabled">
                    <a class="page-link" href="#"><i class="bi bi-chevron-left"></i></a>
                  </li>
                  <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">2</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#">3</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="#"><i class="bi bi-chevron-right"></i></a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
        <!--  ==================
                命題專案管理區塊 
                ================== -->
        <!--  ==================
                命題專案管理區塊 (已移除)
                ================== -->

        <!--  ==================
                角色權限管理區塊 
                ================== -->
        <div class="tab-pane fade" id="pills-roles" role="tabpanel">
          <div class="row g-4" id="roleCardsContainer">
            <!-- 角色卡片將由 JS 動態生成 -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="addRoleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header bg-white border-bottom">
          <div>
            <h5 class="modal-title fw-bold text-dark">新增角色</h5>
            <p class="text-secondary small mb-0">
              設定新角色的基本資訊與圖示
            </p>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="mb-4">
            <label class="form-label fw-bold">角色名稱 <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-lg" id="newRoleName" placeholder="例如：專案經理" />
          </div>
          <div class="mb-4">
            <label class="form-label fw-bold">角色描述</label>
            <textarea class="form-control" id="newRoleDesc" rows="2" placeholder="描述此角色的職責"></textarea>
          </div>
          <div class="mb-4">
            <label class="form-label fw-bold">人員分類 <span class="text-danger">*</span></label>
            <div class="d-flex gap-4">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="newRoleType" id="roleType_internal" value="internal"
                  checked>
                <label class="form-check-label" for="roleType_internal">內部人員</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="newRoleType" id="roleType_external" value="external">
                <label class="form-check-label" for="roleType_external">外部人員</label>
              </div>
            </div>
          </div>
          <div class="mb-4">
            <label class="form-label fw-bold">圖示預覽與主題顏色</label>
            <div class="d-flex align-items-center gap-4">
              <div id="selectedIconPreview" class="icon-preview theme-admin"
                style="width: 64px; height: 64px; font-size: 1.75rem; font-weight: bold; margin-bottom: 0;">
                ?
              </div>
              <div class="d-flex gap-2 flex-wrap">
                <button type="button" class="btn border" style="width: 50px; height: 50px; background: #fef3c7"
                  data-theme="admin" onclick="selectTheme('admin')"></button>
                <button type="button" class="btn border" style="width: 50px; height: 50px; background: #d1fae5"
                  data-theme="teacher" onclick="selectTheme('teacher')"></button>
                <button type="button" class="btn border" style="width: 50px; height: 50px; background: #dbeafe"
                  data-theme="reviewer" onclick="selectTheme('reviewer')"></button>
                <button type="button" class="btn border" style="width: 50px; height: 50px; background: #ede9fe"
                  data-theme="custom1" onclick="selectTheme('custom1')"></button>
                <button type="button" class="btn border" style="width: 50px; height: 50px; background: #fee2e2"
                  data-theme="custom2" onclick="selectTheme('custom2')"></button>
              </div>
            </div>
            <input type="hidden" id="selectedTheme" value="admin" />
            <div class="form-text mt-2">
              圖示字元將自動取用「角色名稱」的第一個字。
            </div>
          </div>
        </div>
        <div class="modal-footer bg-white border-top-0 pt-0 pb-4 pe-4">
          <button type="button" class="btn btn-light btn-lg px-4" data-bs-dismiss="modal">
            取消
          </button>
          <button type="button" class="btn btn-primary btn-lg px-4 fw-bold shadow-sm" onclick="saveNewRole()">
            確認新增
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="permissionModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header bg-white border-bottom-0 pb-0">
          <div>
            <h5 class="modal-title fw-bold text-dark">權限設定</h5>
            <p class="text-secondary small mb-0">
              正在設定角色：<span id="modalRoleTitle" class="fw-bold text-primary fs-5">系統管理員</span>
            </p>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4 bg-light">
          <div class="mb-4 p-3 bg-white border rounded">
            <label class="form-label fw-bold mb-2">人員分類</label>
            <div class="d-flex gap-4">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="permRoleType" id="permType_internal"
                  value="internal">
                <label class="form-check-label" for="permType_internal">內部人員</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="permRoleType" id="permType_external"
                  value="external">
                <label class="form-check-label" for="permType_external">外部人員</label>
              </div>
            </div>
          </div>

          <div class="mb-4">
            <h6 class="fw-bold text-secondary mb-3">可見區塊控制</h6>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">今日提醒區塊</div>
                    <div class="text-secondary small mt-1">
                      顯示截止日、公告通知。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_1" checked />
                  </div>
                </label>
              </div>
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">命題儀表板</div>
                    <div class="text-secondary small mt-1">
                      全體進度圓餅圖與統計。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_2" />
                  </div>
                </label>
              </div>
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">我的命題任務</div>
                    <div class="text-secondary small mt-1">
                      個人的命題入口卡片。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_3" />
                  </div>
                </label>
              </div>
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">審題清單</div>
                    <div class="text-secondary small mt-1">
                      待審核題目入口卡片。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_4" />
                  </div>
                </label>
              </div>
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">教師管理系統</div>
                    <div class="text-secondary small mt-1">
                      進入教師名單列表。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_5" />
                  </div>
                </label>
              </div>
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">角色與權限管理</div>
                    <div class="text-secondary small mt-1">
                      設定系統管理員、新增使用者。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_6" />
                  </div>
                </label>
              </div>

              <!-- perm_7: 系統公告/使用說明 -->
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">系統公告/使用說明</div>
                    <div class="text-secondary small mt-1">
                      查看最新消息與操作手冊。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_7" />
                  </div>
                </label>
              </div>

              <!-- perm_8: 命題專案管理 -->
              <div class="col-md-6">
                <label class="permission-item-card">
                  <div>
                    <div class="fw-bold text-dark">命題專案管理</div>
                    <div class="text-secondary small mt-1">
                      建立新梯次、指派人員與進度控管。
                    </div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input custom-switch-lg" type="checkbox" id="perm_8" />
                  </div>
                </label>
              </div>
            </div>

            <h6 class="fw-bold text-secondary mb-3 mt-4">進階功能權限</h6>
            <div class="row g-3">
              <!-- Proposition Access -->
              <div class="col-12">
                <div class="card border bg-white p-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="fw-bold text-dark">命題任務細節設定</span>
                    <span class="badge bg-light text-secondary border">需開啟「我的命題任務」</span>
                  </div>
                  <div class="d-flex gap-4">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="prop_access" id="prop_view" value="view"
                        disabled>
                      <label class="form-check-label" for="prop_view">僅瀏覽 (View Only)</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="prop_access" id="prop_edit" value="edit"
                        disabled>
                      <label class="form-check-label" for="prop_edit">瀏覽與編輯 (Edit)</label>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Review Access -->
              <div class="col-12">
                <div class="card border bg-white p-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="fw-bold text-dark">審題任務細節設定</span>
                    <span class="badge bg-light text-secondary border">需開啟「審題清單」</span>
                  </div>
                  <div class="d-flex gap-4">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="review_access" id="review_view" value="view"
                        disabled>
                      <label class="form-check-label" for="review_view">僅瀏覽 (View Only)</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="review_access" id="review_edit" value="edit"
                        disabled>
                      <label class="form-check-label" for="review_edit">瀏覽與編輯 (Edit)</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer bg-white border-top-0 pt-0 pb-4 pe-4">
          <button type="button" class="btn btn-light btn-lg px-4 fs-6" data-bs-dismiss="modal">
            取消
          </button>
          <button type="button" class="btn btn-primary btn-lg px-4 fs-6 fw-bold shadow-sm">
            儲存設定
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header bg-white border-bottom">
          <div>
            <h5 class="modal-title fw-bold text-dark">
              編輯使用者：<span id="modalEditTitleName" class="text-primary">--</span>
            </h5>
            <p class="text-secondary small mb-0">
              管理個人資料、聯絡方式與帳號狀態
            </p>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body p-4">
          <input type="hidden" id="editUserId" />

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">使用者姓名</label>
              <input type="text" class="form-control" id="editRealName" />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">登入帳號 (Account)</label>
              <input type="text" class="form-control" id="editAccount" />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">電子信箱 (Email)</label>
              <input type="email" class="form-control" id="editEmail" />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">身分別</label>
              <select class="form-select" id="editRole">
                <option value="admin">網站管理員</option>
                <option value="editor">教師資料編輯者</option>
                <option value="viewer">一般檢視者</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">公司職稱</label>
              <input type="text" class="form-control" id="editTitle" />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">聯絡電話 / 手機</label>
              <input type="text" class="form-control" id="editPhone" />
            </div>

            <hr class="my-4" />

            <div class="col-12">
              <label class="form-label fw-bold mb-2">帳號安全設定</label>
              <div class="d-flex justify-content-between align-items-center p-3 border rounded bg-light">
                <div>
                  <div class="fw-bold">登入密碼</div>
                  <div class="small text-muted">
                    若使用者忘記密碼，可在此協助重設
                  </div>
                </div>
                <button class="btn btn-outline-secondary btn-sm">
                  發送重設密碼信
                </button>
              </div>
            </div>

            <div class="col-12 mt-3">
              <div class="form-check form-switch p-3 border rounded bg-white">
                <input class="form-check-input ms-0 me-3" type="checkbox" id="accountStatus"
                  style="transform: scale(1.2)" />
                <div class="d-inline-block align-middle">
                  <label class="form-check-label fw-bold" for="accountStatus">啟用此帳號</label>
                  <div class="text-muted small">
                    關閉後，使用者將無法登入系統
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer bg-white pt-3 pe-4">
          <button type="button" class="btn btn-light btn-lg px-4 fs-6" data-bs-dismiss="modal">
            關閉
          </button>
          <button type="button" class="btn btn-primary btn-lg px-4 fs-6 fw-bold shadow-sm">
            儲存變更
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- ================
        編輯與新增使用者
         ================ -->
  <div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header bg-white border-bottom">
          <h5 class="modal-title fw-bold">新增系統使用者</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="mb-3">
            <label class="form-label fw-bold">使用者姓名 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="addUserName" placeholder="例如：王小明" />
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">登入帳號 <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="addUserAccount" placeholder="例如：wang_xiaoming" />
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">電子信箱 <span class="text-danger">*</span></label>
            <input type="email" class="form-control" id="addUserEmail" placeholder="name@example.com" />
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">身分別 <span class="text-danger">*</span></label>
            <select class="form-select" id="addUserRole">
              <option selected disabled>請選擇身分...</option>
              <option value="admin">網站管理員</option>
              <option value="editor">教師資料編輯者</option>
              <option value="viewer">一般檢視者</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label fw-bold">公司職稱</label>
            <input type="text" class="form-control" id="addUserTitle" placeholder="例如：經理" />
          </div>
          <div class="alert alert-light border small text-secondary">
            <i class="bi bi-info-circle me-1"></i> 備註：預設密碼為
            <strong>01024304</strong> 公司統編。
          </div>
        </div>
        <div class="modal-footer border-top-0 pt-0">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">
            取消
          </button>
          <button type="button" class="btn btn-primary fw-bold px-4">
            建立帳號
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="role-manager.js"></script>
  <script src="app.js"></script>