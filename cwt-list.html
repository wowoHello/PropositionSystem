<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>我的命題列表 - CWT 命題工作平臺</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/quill.snow.css">
  <link rel="stylesheet" href="css/sweetalert2.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <style>
    /* === QUILL 設定 === */
    /* Quill 編輯器高度設定 */
    .ql-container {
      font-family: "Noto Sans TC", sans-serif;
      font-size: 1rem;
    }

    /* 1. 設定外層容器：讓它高度自動，不要寫死 */
    #q-editor-content,
    #q-reading-main {
      height: auto !important;
      /* 移除寫死的高度，讓它可以包住內部的編輯區 */
    }

    /* 2. 設定內層編輯區 (.ql-editor)：控制卷軸邏輯 */
    #q-editor-content .ql-editor,
    /* 一般題目、精選題目-內容 */
    #q-reading-main .ql-editor,
    /* 閱讀題組-內容 */
    #q-long-content .ql-editor,
    /* 長文題目-內容 */
    #q-long-explanation .ql-editor,
    /* 短文題組-內容 */
    #q-short-main .ql-editor,
    /* 聽力題目-內容 */
    #q-listen-content .ql-editor,
    /* 聽力題目-解析 */
    #q-listen-explanation .ql-editor,
    /* 聽力題目-參考答案 */
    #q-listen-ref-answer .ql-editor {
      /* A. 預設高度 (最矮 200px) */
      min-height: 200px;
      /* B. 最大高度 (超過 400px 就停住) */
      max-height: 400px;
      /* C. 超過最大高度時，出現垂直卷軸 */
      overflow-y: auto;
    }

    /* 選項的高度 (比較矮) */
    .option-editor {
      min-height: 100px;
      max-height: 150px;
    }

    /* 調整選項區塊的標頭 */
    .option-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      background-color: #f8f9fa;
      padding: 5px 10px;
      border-radius: 4px;
      border: 1px solid #dee2e6;
    }

    .ql-editor.ql-blank:focus::before {
      opacity: 0;
    }

    /* 1. 定義編輯器內的字體樣式 */
    .ql-font-microsoft-jhenghei {
      font-family: "Microsoft JhengHei", "微軟正黑體", sans-serif;
    }

    .ql-font-kaiu {
      font-family: "DFKai-SB", "標楷體", serif;
    }

    .ql-font-times-new-roman {
      font-family: "Times New Roman", serif;
    }

    .ql-font-arial {
      font-family: "Arial", sans-serif;
    }

    .ql-font-comic-sans-ms {
      font-family: "Comic Sans MS", cursive;
    }

    /* 2. 設定下拉選單的「標籤名稱」 (這是給人看的) */
    /* === 修正 Quill 字體選單寬度不足的問題 === */
    .ql-snow .ql-picker.ql-font {
      width: 160px !important;
    }

    /* 如果選單展開後的選項也太窄，可以一併調整 (通常上面那行就夠了) */
    .ql-snow .ql-picker.ql-font .ql-picker-label,
    .ql-snow .ql-picker.ql-font .ql-picker-item {
      padding-right: 20px;
    }

    /* 讓選單裡面的選項顯示中文，如果不加這些，它只會顯示空白或預設樣式 */
    /* 選單標題 (選中時) */
    .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="microsoft-jhenghei"]::before,
    .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="microsoft-jhenghei"]::before {
      content: "微軟正黑體";
      font-family: "Microsoft JhengHei";
    }

    .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="kaiu"]::before,
    .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="kaiu"]::before {
      content: "標楷體";
      font-family: "DFKai-SB";
    }

    .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="times-new-roman"]::before,
    .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="times-new-roman"]::before {
      content: "Times New Roman";
      font-family: "Times New Roman";
    }

    .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="arial"]::before,
    .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="arial"]::before {
      content: "Arial";
      font-family: "Arial";
    }

    .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="comic-sans-ms"]::before,
    .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="comic-sans-ms"]::before {
      content: "Comic Sans";
      font-family: "Comic Sans MS";
    }

    /* === QUILL 設定結束 === */
    :root {
      --primary-blue: #2563eb;
      --bg-color: #f0f2f5;
      --text-dark: #1f2937;
      --text-gray: #6b7280;
    }

    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: var(--bg-color);
      color: var(--text-dark);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }


    /* =========================================
   狀態列樣式區隔
   ========================================= */

    /* 1. 鎖定狀態 (已傳送 / Submitted) */
    /* 使用淺灰色背景，讓文字變淡，營造無法編輯的感覺 */
    .row-locked {
      background-color: #f8f9fa !important;
      /* 淺灰背景 */
      color: #adb5bd !important;
      /* 文字變淡 */
    }

    /* 2. 讓該行的一般連結 (如標題) 失效 */
    .row-locked a.fw-bold {
      color: #adb5bd !important;
      pointer-events: none;
      /* 禁止點擊標題 */
      text-decoration: none;
    }

    /* 3. 讓 Checkbox 看起來是停用的 */
    .row-locked .form-check-input {
      background-color: #e9ecef;
      border-color: #dee2e6;
      opacity: 0.5;
      pointer-events: none;
      /* 禁止點擊 Checkbox */
    }

    /* 4. 讓「檢視」按鈕恢復可點擊 */
    .row-locked button {
      pointer-events: auto !important;
      cursor: pointer;
      color: #3b82f6 !important;
      opacity: 1 !important;
    }

    /* =========================================
         原有的樣式保留 (Breadcrumb, Main Content)
         ========================================= */

    /* 3. 主要內容區 */
    .main-content {
      padding: 2rem 0;
      flex-grow: 1;
    }

    .page-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #111827;
      margin-bottom: 0.25rem;
    }

    .page-desc {
      color: var(--text-gray);
      font-size: 0.95rem;
      margin-bottom: 1.5rem;
    }

    /* 通用卡片樣式 */
    .card-box {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      border: 1px solid #e5e7eb;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    /* 搜尋區 */
    .search-area .input-group-text {
      display: flex;
      align-items: center;
    }

    .search-area .form-label {
      font-size: 0.85rem;
      font-weight: 700;
      color: #374151;
      margin-bottom: 0.4rem;
    }

    .search-area .form-select,
    .search-area .form-control {
      background-color: #f9fafb;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 0.6rem 1rem;
      font-size: 0.95rem;
    }

    .btn-search {
      background-color: #2563eb;
      color: white;
      border-radius: 8px;
      font-weight: 600;
      padding: 0.6rem 1.5rem;
      border: none;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .btn-search:hover {
      background-color: #1d4ed8;
    }

    /* 統計卡片區 */
    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 1.25rem;
      border: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      height: 100%;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      flex-shrink: 0;
    }

    .stat-info span {
      display: block;
      color: #6b7280;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
    }

    .stat-info h4 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: #111827;
      line-height: 1;
    }

    /* 統計圖示顏色 */
    .icon-gray {
      background-color: #f3f4f6;
      color: #6b7280;
    }

    .icon-orange {
      background-color: #fff7ed;
      color: #f97316;
    }

    .icon-green {
      background-color: #f0fdf4;
      color: #10b981;
    }

    .icon-blue {
      background-color: #eff6ff;
      color: #3b82f6;
    }

    /* 列表區 */
    .table-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
    }

    .btn-outline-blue {
      border: 1px solid #2563eb;
      color: #2563eb;
      background: white;
      font-weight: 600;
      border-radius: 6px;
      padding: 0.4rem 1rem;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-outline-blue:hover {
      background-color: #eff6ff;
    }

    /* 新的工具列按鈕樣式：取代原本的 btn-toolbar-gray */
    .btn-tool {
      background: white;
      border: 1px solid #d1d5db;
      /* 邊框深灰色，比較有實體感 */
      color: #374151;
      /* 文字改為深灰色，看起來是「可用」的 */
      font-weight: 600;
      border-radius: 6px;
      padding: 0.4rem 1rem;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      /* 增加一點圖示跟文字的間距 */
      transition: all 0.2s ease;
      /* 加入平滑過渡動畫 */
    }

    /* 滑鼠移上去的效果 (Hover) */
    .btn-tool:hover,
    .btn-tool:focus,
    .btn-tool[aria-expanded="true"] {
      /* 下拉選單打開時也保持藍色 */
      border-color: #2563eb;
      color: #2563eb;
      background-color: #eff6ff;
      /* 非常淡的藍色背景 */
      box-shadow: 0 2px 4px rgba(37, 99, 235, 0.1);
      /* 輕微的藍色陰影 */
    }

    /* 按鈕內的假 Checkbox 方塊樣式優化 */
    .icon-checkbox {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid #9ca3af;
      /* 預設邊框 */
      border-radius: 3px;
      transition: all 0.2s;
    }

    /* 當按鈕 Hover 時，那個小方塊也要變色 */
    .btn-tool:hover .icon-checkbox {
      border-color: #2563eb;
    }

    /* 表格樣式 */
    .custom-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    .custom-table th {
      background-color: #f3f4f6;
      color: #374151;
      font-weight: 700;
      padding: 1rem;
      font-size: 0.9rem;
      border-bottom: 2px solid #e5e7eb;
      text-align: left;
    }

    .custom-table td {
      padding: 1rem;
      vertical-align: middle;
      border-bottom: 1px solid #f3f4f6;
      color: #4b5563;
      font-size: 0.95rem;
    }

    .custom-table tr:hover td {
      background-color: #f9fafb;
    }

    /* 狀態標籤 */
    .badge-outline {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid;
      background: white;
      display: inline-block;
    }

    .badge-draft {
      color: #d97706;
      border-color: #d97706;
    }

    .badge-confirmed {
      color: #059669;
      border-color: #059669;
    }

    .badge-sent {
      color: #2563eb;
      border-color: #2563eb;
    }

    /* 操作連結 */
    .action-links a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .action-links a:hover {
      text-decoration: underline;
    }

    .action-divider {
      color: #d1d5db;
      margin: 0 4px;
    }

    /* Tooltip */
    .custom-tooltip .tooltip-inner {
      background-color: #1f2937;
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 0.85rem;
      max-width: 280px;
      text-align: left;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* 分頁 */
    .pagination-container {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin-top: 1rem;
      gap: 10px;
    }

    .page-info {
      color: #6b7280;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .page-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      color: #6b7280;
      text-decoration: none;
      background: white;
      font-size: 0.9rem;
    }

    .page-btn.active {
      background-color: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    .page-btn:hover:not(.active) {
      background-color: #f3f4f6;
    }

    .hover-effect:active {
      transform: scale(0.9);
      /* 點擊時稍微縮小 */
    }

    /* =========== */
    /* 一般題型樣式 */
    /* =========== */
    /* 必填星號 */
    .required-star::after {
      content: " *";
      color: #dc3545;
    }

    /* 選項輸入框優化 */
    .question-form-group .input-group-text {
      border-color: #dee2e6;
    }

    .question-form-group .form-control:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.15);
    }

    /* 選項卡片樣式 Redesign */
    .option-card {
      border: 1px solid #e5e7eb;
      background-color: white;
      transition: all 0.2s ease;
      position: relative;
    }

    .option-header-styled {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background-color: #f9fafb;
      border-bottom: 1px solid #e5e7eb;
      cursor: pointer;
      /* 整條可點 */
      transition: background-color 0.2s;
    }

    .option-header-styled:hover {
      background-color: #f3f4f6;
    }

    /* === 使用 CSS :has 選擇器處理選取狀態 (無需 JS) === */

    /* 1. 外框與陰影：當內部 radio 被選中時 */
    .option-card:has(input[type="radio"]:checked) {
      border-color: #10b981;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
      /* 輕微綠色陰影 */
      /* 不再顯示左側綠色 border */
    }

    /* 2. 標頭變色 */
    .option-card:has(input[type="radio"]:checked) .option-header-styled {
      background-color: #f0fdf4;
      /* 極淡綠色標題 */
      border-bottom-color: #86efac;
    }

    /* 3. 文字變色 */
    .option-card:has(input[type="radio"]:checked) .form-check-label {
      color: #059669 !important;
      font-weight: 800 !important;
    }

    /* 4. ★★★ 關鍵修正：確保編輯器區域永遠維持白色背景 ★★★ */
    /* 強制覆蓋任何可能繼承的背景色 */
    .question-form-group .ql-toolbar,
    .question-form-group .ql-container,
    .option-editor,
    .option-card:has(input[type="radio"]:checked) .ql-toolbar,
    .option-card:has(input[type="radio"]:checked) .ql-container {
      background-color: white !important;
      border-color: #dee2e6 !important;
    }

    /* 移除舊的 input-group 樣式干擾，避免它同時生效 */
    .input-group:has(input[type="radio"]:checked) .form-control {
      background-color: white !important;
      border-color: #dee2e6 !important;
    }

    /* 選項收合速度 */
    .collapsing {
      transition: height 0.6s ease;
    }

    /* 互動式狀態 Icon */
    .stat-icon.interactive {
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-icon.interactive:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .stat-icon.interactive:active {
      transform: scale(0.95);
    }
  </style>
</head>

<body>
  <nav class="top-navbar">
    <div class="container-fluid px-4">
      <div class="row align-items-center">
        <div class="col-3">
          <a href="firstpage.html" class="navbar-brand">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
            </svg>
            CWT 命題工作平臺
          </a>
        </div>

        <div class="col-6 d-flex justify-content-center">
          <div class="project-switcher">
            <div class="project-display glass-enhanced" id="projectToggle">
              <div class="glass-icon">
                <img src="ICON/calendar.svg" alt="Calendar" style="width: 24px; height: 24px;">
              </div>

              <div class="project-info">
                <div class="project-year" id="currentProjectYear">
                  2024年度
                </div>
                <div class="project-name" id="currentProjectName">
                  進行中梯次範例一
                </div>
              </div>
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
              </svg>
            </div>

            <div class="project-dropdown" id="projectDropdown">
              <div class="dropdown-header">
                <span>切換專案</span>
                <button class="close-btn" id="closeDropdown">
                  <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path
                      d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                  </svg>
                </button>
              </div>

              <div class="project-search">
                <input type="text" placeholder="搜尋專案名稱..." id="projectSearchInput" />
              </div>

              <div class="project-list" id="projectList">
                <div class="project-category">進行中 (3)</div>

                <div class="project-item active" data-project-id="1" data-year="2024" data-name="進行中梯次範例一"
                  data-role="admin">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例一
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2024/12/31</span>
                    </div>
                  </div>
                  <span class="role-badge role-admin">系統管理員</span>
                </div>

                <div class="project-item" data-project-id="2" data-year="2024" data-name="進行中梯次範例二"
                  data-role="reviewer">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例二
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2024/11/15</span>
                    </div>
                  </div>
                  <span class="role-badge role-reviewer">審題委員</span>
                </div>

                <div class="project-item" data-project-id="3" data-year="2024" data-name="進行中梯次範例三" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例三
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2025/01/20</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-category">已結束 (5)</div>

                <div class="project-item" data-project-id="4" data-year="2023" data-name="已結束梯次範例一" data-role="admin">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例一
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-admin">系統管理員</span>
                </div>

                <div class="project-item" data-project-id="5" data-year="2023" data-name="已結束梯次範例二" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例二
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-item" data-project-id="6" data-year="2023" data-name="已結束梯次範例三"
                  data-role="reviewer">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例三
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-reviewer">審題委員</span>
                </div>

                <div class="project-item" data-project-id="7" data-year="2022" data-name="已結束梯次範例四" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例四
                    </div>
                    <div class="project-item-meta">
                      <span>2022年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-item" data-project-id="8" data-year="2022" data-name="已結束梯次範例五" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例五
                    </div>
                    <div class="project-item-meta">
                      <span>2022年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-3">
          <div class="user-section">
            <div class="user-info">
              <div class="user-avatar">沈</div>
              <span class="user-name">沈雅茹</span>
              <span class="role-badge role-admin" id="currentUserRole">系統管理員</span>
            </div>
            <a href="index.html" class="btn btn-sm btn-light fw-bold text-primary px-3">
              登出
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="breadcrumb-bar">
    <div class="container-fluid px-4 d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <a href="firstpage.html" class="breadcrumb-item-link">首頁</a>
        <span class="breadcrumb-separator">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </span>
        <span class="breadcrumb-current">我的命題任務</span>
      </div>

      <div class="bg-white rounded-pill px-2 py-1 border d-flex align-items-center shadow-sm"
        style="width: fit-content;">

        <span class="text-muted d-flex align-items-center me-2 border-end pe-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-type"
            viewBox="0 0 16 16">
            <path
              d="m2.244 13.081.943-2.803H6.66l.944 2.803H8.86L5.54 3.75H4.322L1 13.081zm2.7-7.923L6.34 9.314H3.51l1.4-4.156zm9.146 7.027h.035v.896h1.128V8.125c0-1.51-1.114-2.345-2.646-2.345-1.736 0-2.59.916-2.666 2.174h1.108c.068-.718.595-1.19 1.517-1.19.971 0 1.518.52 1.518 1.464v.731H12.19c-1.647.007-2.522.8-2.522 2.058 0 1.319.957 2.18 2.345 2.18 1.06 0 1.716-.43 2.078-1.011zm-1.763.035c-.752 0-1.456-.397-1.456-1.244 0-.65.424-1.115 1.408-1.115h1.805v.834c0 .896-.752 1.525-1.757 1.525" />
          </svg>
        </span>

        <button
          class="btn btn-sm bg-transparent border-0 p-0 rounded-circle d-flex align-items-center justify-content-center hover-effect"
          style="width: 32px; height: 32px; transition: transform 0.1s;" onclick="changeFontSize(-1)" title="縮小">
          <img src="ICON/minus.png" alt="縮小" style="width: 26px; height: auto;">
        </button>

        <span class="small fw-bold text-secondary mx-2 user-select-none"
          style="cursor: pointer; min-width: 45px; text-align: center; transition: color 0.3s;"
          onclick="resetFontSize()" id="fontSizeDisplay" title="點擊還原預設值">
          100%
        </span>

        <button
          class="btn btn-sm bg-transparent border-0 p-0 rounded-circle d-flex align-items-center justify-content-center hover-effect"
          style="width: 32px; height: 32px; transition: transform 0.1s;" onclick="changeFontSize(1)" title="放大">
          <img src="ICON/add.png" alt="放大" style="width: 28px; height: auto;">
        </button>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="container px-4">
      <h1 class="page-title">我的命題任務</h1>
      <p class="page-desc">
        檢視和管理您的所有命題，包括草稿、已確認和已傳送的試題。
      </p>

      <div class="card-box search-area">
        <div class="row g-3 align-items-end">
          <div class="col-md-2">
            <label class="form-label">題型篩選</label>
            <select class="form-select" id="filterType">
              <option value="all" selected>全部題型</option>
              <option value="一般題目">一般題目</option>
              <option value="精選題目">精選題目</option>
              <option value="閱讀題組">閱讀題組</option>
              <option value="短文題組">短文題組</option>
              <option value="長文題目">長文題目</option>
              <option value="聽力題目">聽力題目</option>
              <option value="聽力題組">聽力題組</option>
            </select>
          </div>

          <div class="col-md-2">
            <label class="form-label">等級篩選</label>
            <select class="form-select" id="filterLevel">
              <option value="all" selected>全部等級</option>
            </select>
          </div>

          <div class="col-md-2">
            <label class="form-label">狀態篩選</label>
            <select class="form-select" id="filterStatus">
              <option value="all" selected>全部狀態</option>
              <option value="草稿">草稿</option>
              <option value="已確認">已確認</option>
              <option value="已傳送">已傳送</option>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">關鍵字搜尋</label>
            <div class="d-flex gap-2">
              <div class="input-group">
                <span class="input-group-text bg-white text-secondary border-end-0">
                  <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                  </svg>
                </span>
                <input type="text" id="searchInput" class="form-control border-start-0 ps-2" placeholder="依題目文字搜尋" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="alert alert-info alert-dismissible fade show d-flex align-items-center mb-4 shadow-sm" role="alert"
        style="border-left: 5px solid #0dcaf0;">
        <svg xmlns="http://www.w3.org/2000/svg" class="bi flex-shrink-0 me-3" width="24" height="24" fill="currentColor"
          viewBox="0 0 16 16">
          <path
            d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
        </svg>
        <div>
          <strong>操作提示：</strong> 點擊下方統計卡片中的 <span class="badge rounded-pill bg-light text-dark border mx-1">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="icon-orange">
              <path
                d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0zM9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1zM4.5 9a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1h-7zm0 2.5a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1h-4z" />
            </svg>
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="icon-green">
              <path
                d="M5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z" />
              <path fill="white"
                d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z" />
            </svg>
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="icon-blue">
              <path
                d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z" />
            </svg>
            圖示</span> ( 草稿、已確認、已傳送 )，即可將列表選取的項目 <strong class="text-primary">批次變更</strong>
          為該狀態。
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>

      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon icon-gray">
              <img src="ICON/folder.svg" alt="Calendar" style="width: 24px; height: 24px;">
            </div>
            <div class="stat-info">
              <span>總計</span>
              <h4 id="stat-total">3</h4>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon icon-orange interactive" onclick="batchUpdateStatus('草稿')" title="將選取項目設為「草稿」">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0zM9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1zM4.5 9a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1h-7zm0 2.5a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1h-4z" />
              </svg>
            </div>
            <div class="stat-info">
              <span>草稿</span>
              <h4 id="stat-draft">1</h4>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon icon-green interactive" onclick="batchUpdateStatus('已確認')" title="將選取項目設為「已確認」">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z" />
                <path fill="white"
                  d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z" />
              </svg>
            </div>
            <div class="stat-info">
              <span>已確認</span>
              <h4 id="stat-confirmed">1</h4>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon icon-blue interactive" onclick="batchUpdateStatus('已傳送')" title="將選取項目設為「已傳送」">
              <svg width="22" height="22" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z" />
              </svg>
            </div>
            <div class="stat-info">
              <span>已傳送</span>
              <h4 id="stat-sent">1</h4>
            </div>
          </div>
        </div>
      </div>

      <div class="card-box p-0 overflow-hidden">
        <div class="p-3 table-toolbar m-0">
          <div class="d-flex align-items-center gap-3">
            <div class="d-flex align-items-center gap-2">
              <span class="small fw-bold text-secondary text-nowrap">每頁顯示筆數</span>
              <select class="form-select form-select-sm">
                <option>10 筆</option>
                <option>20 筆</option>
              </select>
            </div>
          </div>

          <div class="d-flex gap-2">
            <button class="btn-tool text-danger" onclick="batchAction('刪除')">
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="me-1">
                <path
                  d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                <path
                  d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
              </svg>
              <span>批次刪除</span>
            </button>

            <button class="btn-tool" onclick="resetSelection()">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                </path>
              </svg>
              重置選擇
            </button>
            <button class="btn btn-primary d-flex align-items-center gap-2 shadow-sm"
              onclick="openPropModal(null, 'create')">
              <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path>
              </svg>
              <span class="fw-bold">新增試題</span>
            </button>
          </div>
        </div>

        <div class="px-3 pb-3">
          <table class="custom-table">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" class="form-check-input" />
                </th>
                <th style="width: 35%">題目內容摘要</th>
                <th>等級</th>
                <th>題型</th>
                <th>狀態</th>
                <th>建立時間</th>
                <th>最後修改時間</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr class="data-row" data-type="一般題目" data-status="草稿" data-level="中級"
                data-json='{"level":"中級","mainCat":"文字","subCat":"字音","content":"%3Cp%3E%E9%80%99%E6%98%AF%E4%B8%80%E7%AF%87%E7%AF%84%E4%BE%8B%E6%96%87%E7%AB%A0...%3C%2Fp%3E","subQuestions":[{"content":"%3Cp%3E%E5%AD%90%E9%A1%8C%E4%B8%80%E7%9A%84%E5%85%A7%E5%AE%B9%3C%2Fp%3E","optA":"%3Cp%3EA%3C%2Fp%3E","optB":"%3Cp%3EB%3C%2Fp%3E","optC":"%3Cp%3EC%3C%2Fp%3E","optD":"%3Cp%3ED%3C%2Fp%3E","ans":"A"}]}'>
                <td><input type="checkbox" class="form-check-input" /></td>
                <td class="text-dark fw-medium">
                  關於人工智慧在教育應用的題目...
                </td>
                <td><span class="badge bg-light text-dark border">中級</span></td>
                <td>一般題目</td>
                <td><span class="badge-outline badge-draft">草稿</span></td>
                <td>2024-05-20 10:30</td>
                <td>2024-05-21 14:15</td>
                <td class="action-links">
                  <button class="btn btn-link p-0 text-decoration-none small fw-bold"
                    onclick="openPropModal(this, 'view')">檢視</button>
                  <span class="text-muted mx-1">|</span>
                  <button class="btn btn-link p-0 text-decoration-none small fw-bold text-success"
                    onclick="openPropModal(this, 'edit')">編輯</button>
                  <span class="text-muted mx-1">|</span>
                  <button class="btn btn-link p-0 text-decoration-none small fw-bold text-danger"
                    onclick="deleteRow(this)">刪除</button>
                </td>
              </tr>

              <tr class="data-row" data-type="精選題目" data-status="已確認" data-level="初級"
                data-json='{"level":"初級","mainCat":"修辭技巧","subCat":"修辭類型","content":"%3Cp%3E%E9%80%99%E6%98%AF%E4%B8%80%E7%AF%87%E7%AF%84%E4%BE%8B%E6%96%87%E7%AB%A0...%3C%2Fp%3E","subQuestions":[{"content":"%3Cp%3E%E5%AD%90%E9%A1%8C%E4%B8%80%E7%9A%84%E5%85%A7%E5%AE%B9%3C%2Fp%3E","optA":"%3Cp%3EA%3C%2Fp%3E","optB":"%3Cp%3EB%3C%2Fp%3E","optC":"%3Cp%3EC%3C%2Fp%3E","optD":"%3Cp%3ED%3C%2Fp%3E","ans":"A"}]}'>
                <td><input type="checkbox" class="form-check-input" /></td>
                <td class="text-dark fw-medium">
                  下列哪個選項修辭技巧使用正確？
                </td>
                <td><span class="badge bg-light text-dark border">初級</span></td>
                <td>精選題目</td>
                <td>
                  <span class="badge-outline badge-confirmed">已確認</span>
                </td>
                <td>2024-05-18 09:00</td>
                <td>2024-05-19 11:20</td>
                <td class="action-links">
                  <button class="btn btn-link p-0 text-decoration-none small fw-bold"
                    onclick="openPropModal(this, 'view')">檢視</button>
                  <span class="text-muted mx-1">|</span>
                  <button class="btn btn-link p-0 text-decoration-none small fw-bold text-success"
                    onclick="openPropModal(this, 'edit')">編輯</button>
                  <span class="text-muted mx-1">|</span>
                  <button class="btn btn-link p-0 text-decoration-none small fw-bold text-danger"
                    onclick="deleteRow(this)">刪除</button>
                </td>
              </tr>

              <tr class="data-row row-locked" data-type="閱讀題組" data-status="已傳送" data-level="中高級"
                data-json='{"level":"中高級","mainCat":"語體文","content":"%3Cp%3E%E9%80%99%E6%98%AF%E4%B8%80%E7%AF%87%E7%AF%84%E4%BE%8B%E6%96%87%E7%AB%A0...%3C%2Fp%3E","subQuestions":[{"content":"%3Cp%3E%E5%AD%90%E9%A1%8C%E4%B8%80%E7%9A%84%E5%85%A7%E5%AE%B9%3C%2Fp%3E","optA":"%3Cp%3EA%3C%2Fp%3E","optB":"%3Cp%3EB%3C%2Fp%3E","optC":"%3Cp%3EC%3C%2Fp%3E","optD":"%3Cp%3ED%3C%2Fp%3E","ans":"A"}]}'>
                <td><input type="checkbox" class="form-check-input" disabled /></td>
                <td class="text-dark fw-medium">
                  [閱讀] 閱讀下文，回答問題 3-5... (共1子題)
                </td>
                <td><span class="badge bg-light text-dark border">中高級</span></td>
                <td>閱讀題組</td>
                <td><span class="badge-outline badge-sent">已傳送</span></td>
                <td>2024-05-15 16:45</td>
                <td>2024-05-16 10:00</td>
                <td class="action-links">
                  <button class="btn btn-link p-0 text-decoration-none small fw-bold"
                    onclick="openPropModal(this, 'view')">檢視</button>
                </td>
              </tr>

              <tr id="noDataRow" style="display: none">
                <td colspan="7" class="text-center py-5 text-secondary">
                  <div class="d-flex flex-column align-items-center opacity-50">
                    <h6 class="fw-bold mt-2">沒有符合的試題</h6>
                    <p class="small">請嘗試調整搜尋條件</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="pagination-container">
            <span class="page-info">第 1 頁 / 共 2 頁</span>
            <a href="#" class="page-btn disabled">&lt;</a>
            <a href="#" class="page-btn active">1</a>
            <a href="#" class="page-btn">2</a>
            <a href="#" class="page-btn">&gt;</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 一般題型 -->
  <div class="modal fade" id="propModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content border-0 rounded-4 shadow">

        <div class="modal-header border-bottom-0">
          <h5 class="modal-title fw-bold" id="propModalTitle">編輯命題</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body pt-0">
          <form id="propForm">
            <input type="hidden" id="editRowFrom" value="">

            <div class="row g-3 mb-3 pb-3 border-bottom">
              <div class="col-md-6">
                <label class="form-label fw-bold small text-secondary">題型選擇</label>
                <select class="form-select" id="mType">
                  <option value="一般題目" selected>一般題目</option>
                  <option value="長文題目">長文題目</option>
                  <option value="短文題組">短文題組</option>
                  <option value="精選題目">精選題目</option>
                  <option value="閱讀題組">閱讀題組</option>
                  <option value="聽力題目">聽力題目</option>
                  <option value="聽力題組">聽力題組</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold small text-secondary">目前狀態</label>
                <div>
                  <span class="badge-outline badge-draft" id="mStatusBadge">草稿</span>
                </div>
              </div>
            </div>

            <div id="dynamicFormContainer">
              <!-- 一般題目 -->
              <!-- 精選題目 -->
              <div id="form-general" class="question-form-group">

                <!-- 第一區塊：基本資料 -->
                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-info-circle me-2"></i>
                    一、題目基本資料
                  </h6>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">適用等級</label>
                      <select class="form-select" id="gLevel">
                        <option value="">請選擇...</option>
                        <option value="初等">初等</option>
                        <option value="中等">中等</option>
                        <option value="中高等">中高等</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">主類</label>
                      <select class="form-select" id="gMainCategory">
                        <option value="">請選擇...</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">次類</label>
                      <select class="form-select readonly-field" id="gSubCategory" disabled>
                        <option value="">請先選擇主題</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary">難度</label>
                      <select class="form-select" id="gDifficulty">
                        <option value="">請選擇...</option>
                        <option value="難度 1">難度 1</option>
                        <option value="難度 2" selected>難度 2</option>
                        <option value="難度 3">難度 3</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary">命題者 (您)</label>
                      <input type="text" class="form-control readonly-field" id="gPropositioner" value="沈雅茹" disabled
                        readonly>
                    </div>
                  </div>
                </div>

                <!-- 第二區塊：題目內容 (含選項) -->
                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-file-text me-2"></i>
                    二、題目內容與選項
                  </h6>
                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">題幹內容</label>
                    <div id="q-editor-content"></div>
                  </div>
                  <div class="mb-4">
                    <label class="form-label fw-bold small text-secondary">附檔 (圖片/PDF)</label>
                    <div class="input-group">
                      <input class="form-control" type="file" id="gAttachment">
                    </div>
                    <div class="form-text small mt-1 text-primary d-none" id="gAttachmentName"></div>
                  </div>

                  <!-- 選項區域 (移至此處) -->
                  <label class="form-label fw-bold small text-secondary mb-2">選項與正確答案</label>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <div class="option-header-styled">
                          <span class="badge bg-secondary">選項 A</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="correctAnswer" value="A" id="radioA">
                            <label class="form-check-label small fw-bold text-success" for="radioA">設為正確答案</label>
                          </div>
                        </div>
                        <div id="q-editor-optA" class="option-editor border-0"></div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <div class="option-header-styled">
                          <span class="badge bg-secondary">選項 B</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="correctAnswer" value="B" id="radioB">
                            <label class="form-check-label small fw-bold text-success" for="radioB">設為正確答案</label>
                          </div>
                        </div>
                        <div id="q-editor-optB" class="option-editor border-0"></div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <div class="option-header-styled">
                          <span class="badge bg-secondary">選項 C</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="correctAnswer" value="C" id="radioC">
                            <label class="form-check-label small fw-bold text-success" for="radioC">設為正確答案</label>
                          </div>
                        </div>
                        <div id="q-editor-optC" class="option-editor border-0"></div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <div class="option-header-styled">
                          <span class="badge bg-secondary">選項 D</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="correctAnswer" value="D" id="radioD">
                            <label class="form-check-label small fw-bold text-success" for="radioD">設為正確答案</label>
                          </div>
                        </div>
                        <div id="q-editor-optD" class="option-editor border-0"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 第三區塊：參考答案及解析 (只留解析) -->
                <div class="p-3 bg-white border rounded mb-3 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-lightbulb me-2"></i>
                    三、解析
                  </h6>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary">解析 (紀錄答案理由)</label>
                    <div id="q-editor-explanation" style="height: 150px;"></div>
                  </div>
                </div>
              </div>
              <!-- 長文題目 -->
              <div id="form-longarticle" class="question-form-group d-none">
                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-info-circle me-2"></i>
                    一、題目基本資料
                  </h6>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">適用等級</label>
                      <select class="form-select" id="lLevel">
                        <option value="">請選擇...</option>
                        <option value="初等">初等</option>
                        <option value="中等">中等</option>
                        <option value="中高等">中高等</option>
                        <option value="優等">優等</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">題型</label>
                      <select class="form-select" id="lType">
                        <option value="">請選擇...</option>
                        <option value="引導寫作">引導寫作</option>
                        <option value="資訊整合">資訊整合</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary">命題者</label>
                      <input type="text" class="form-control readonly-field" id="lPropositioner" value="沈雅茹" disabled
                        readonly>
                    </div>
                  </div>
                </div>

                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-file-text me-2"></i>
                    二、題目內容
                  </h6>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">題目</label>
                    <input type="text" class="form-control" id="lTopic" placeholder="請輸入標題...">
                  </div>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">內容</label>
                    <div id="q-long-content"></div>
                  </div>

                  <div class="mb-4">
                    <label class="form-label fw-bold small text-secondary">附檔 (圖片/PDF)</label>
                    <div class="input-group">
                      <input class="form-control" type="file" id="lAttachment">
                    </div>
                    <div class="form-text small mt-1 text-primary d-none" id="lAttachmentName"></div>
                  </div>
                </div>

                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-lightbulb me-2"></i>
                    三、詳解與解析 (選填)
                  </h6>
                  <div id="q-long-explanation"></div>
                </div>
              </div>
              <!-- 短文題組 -->
              <div id="form-shortarticle" class="question-form-group d-none">
                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-info-circle me-2"></i>
                    一、題目基本資料
                  </h6>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label fw-bold small text-secondary">主類</label>
                      <input type="text" class="form-control readonly-field" id="sMainCat" value="文義判讀" disabled
                        readonly>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold small text-secondary">次類</label>
                      <input type="text" class="form-control readonly-field" id="sSubCat" value="篇章辨析" disabled
                        readonly>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">適用等級</label>
                      <select class="form-select" id="sLevel">
                        <option value="">請選擇...</option>
                        <option value="高等">高等</option>
                        <option value="優等">優等</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">文體</label>
                      <select class="form-select" id="sGenre">
                        <option value="">請選擇...</option>
                        <option value="文言文">文言文</option>
                        <option value="應用文">應用文</option>
                        <option value="語體文">語體文</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary">命題者</label>
                      <input type="text" class="form-control readonly-field" id="sPropositioner" value="沈雅茹" disabled
                        readonly>
                    </div>
                  </div>
                </div>

                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-file-text me-2"></i>
                    二、題目內容 (母題與子題)
                  </h6>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">題目</label>
                    <input type="text" class="form-control" id="sTopic" placeholder="請輸入標題...">
                  </div>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">母題文章內容</label>
                    <div id="q-short-main"></div>
                  </div>

                  <div class="mb-4">
                    <label class="form-label fw-bold small text-secondary">附檔 (圖片/PDF)</label>
                    <div class="input-group">
                      <input class="form-control" type="file" id="sAttachment">
                    </div>
                    <div class="form-text small mt-1 text-primary d-none" id="sAttachmentName"></div>
                  </div>

                  <div class="bg-light p-3 rounded border">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="fw-bold text-dark m-0">
                        <i class="bi bi-list-ol me-1"></i>
                        子題列表
                      </h6>
                      <button type="button" class="btn btn-sm btn-primary" onclick="Short_AddSub()">
                        + 新增子題
                      </button>
                    </div>

                    <div id="short-sub-container"></div>

                    <div id="short-sub-empty" class="text-center py-4 text-muted border border-dashed rounded bg-white">
                      尚未新增任何子題，請點擊右上方按鈕新增。
                    </div>
                  </div>
                </div>

                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-lightbulb me-2"></i>
                    三、批說 (選填)
                  </h6>
                  <p class="text-muted small m-0">
                    <i class="bi bi-info-circle me-1"></i>
                    短文題組的批說請於上方「子題列表」中逐題設定。
                  </p>
                </div>
              </div>
              <!-- 閱讀題組 -->
              <div id="form-reading" class="question-form-group d-none">

                <!-- 第一區塊：題目基本資料 -->
                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-info-circle me-2"></i>
                    一、題目基本資料
                  </h6>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label fw-bold small text-secondary required-star">適用等級</label>
                      <select class="form-select" id="rLevel">
                        <option value="">請選擇...</option>
                        <option value="初級">初級</option>
                        <option value="中級">中級</option>
                        <option value="中高">中高</option>
                        <option value="高">高</option>
                        <option value="優">優</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold small text-secondary required-star">文體</label>
                      <select class="form-select" id="rGenre">
                        <option value="">請選擇...</option>
                        <option value="文言文">文言文</option>
                        <option value="應用文">應用文</option>
                        <option value="語體文">語體文</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold small text-secondary">難度</label>
                      <select class="form-select" id="rDifficulty">
                        <option value="">請選擇...</option>
                        <option value="難度 1">難度 1</option>
                        <option value="難度 2">難度 2</option>
                        <option value="難度 3">難度 3</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label fw-bold small text-secondary">命題者</label>
                      <input type="text" class="form-control readonly-field" id="rPropositioner" value="沈雅茹" disabled
                        readonly>
                    </div>
                  </div>
                </div>

                <!-- 第二區塊：題目內容 -->
                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-file-text me-2"></i>
                    二、題目內容 (母題與子題)
                  </h6>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">母題文章內容</label>
                    <div id="q-reading-main"></div>
                  </div>

                  <div class="mb-4">
                    <label class="form-label fw-bold small text-secondary">附檔 (圖片/PDF)</label>
                    <input class="form-control" type="file" id="rAttachment">
                  </div>

                  <!-- 子題列表區塊 -->
                  <div class="bg-light p-3 rounded border">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="fw-bold text-dark m-0">
                        <i class="bi bi-list-ol me-1"></i>
                        子題列表
                      </h6>
                      <button type="button" class="btn btn-sm btn-primary" onclick="Reading_AddSub()">
                        + 新增子題
                      </button>
                    </div>

                    <div id="sub-questions-container"></div>

                    <div id="sub-questions-empty"
                      class="text-center py-4 text-muted border border-dashed rounded bg-white">
                      尚未新增任何子題，請點擊右上方按鈕新增。
                    </div>
                  </div>
                </div>

                <!-- 第三區塊：(閱讀題組無統一解析，保留區塊結構或隱藏) -->
                <!-- 註：使用者要求三個區塊，但對閱讀題組而言，解析通常在子題內。
                     這裡可以放一個全域備註或暫時隱藏，或者說明「請於子題內編輯解析」。 -->
                <div class="p-3 bg-white border rounded mb-3 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-lightbulb me-2"></i>
                    三、參考答案及解析
                  </h6>
                  <p class="text-muted small m-0">
                    <i class="bi bi-info-circle me-1"></i>
                    閱讀題組的答案與解析請於上方「子題列表」中逐題設定。
                  </p>
                </div>

              </div>
              <!-- 聽力題目 -->
              <div id="form-listen" class="question-form-group d-none">

                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-info-circle me-2"></i>
                    一、題目基本資料
                  </h6>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">難度</label>
                      <select class="form-select" id="liLevel">
                        <option value="">請選擇...</option>
                        <option value="難度一">難度一</option>
                        <option value="難度二">難度二</option>
                        <option value="難度三">難度三</option>
                        <option value="難度四">難度四</option>
                        <option value="難度五">難度五</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">核心能力</label>
                      <select class="form-select readonly-field" id="liCore" disabled>
                        <option value="">請先選擇難度</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">細目指標</label>
                      <select class="form-select readonly-field" id="liIndicator" disabled>
                        <option value="">請先選擇難度</option>
                      </select>
                    </div>

                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">語音類型</label>
                      <select class="form-select" id="liVoiceType">
                        <option value="">請選擇...</option>
                        <option value="對話">對話</option>
                        <option value="情境">情境</option>
                        <option value="陳述">陳述</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary required-star">素材分類</label>
                      <select class="form-select" id="liMaterial">
                        <option value="">請選擇...</option>
                        <option value="生活">生活</option>
                        <option value="教育">教育</option>
                        <option value="職場">職場</option>
                        <option value="專業">專業</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label fw-bold small text-secondary">命題者</label>
                      <input type="text" class="form-control readonly-field" id="liPropositioner" value="沈雅茹" disabled
                        readonly>
                    </div>
                  </div>
                </div>

                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-file-text me-2"></i>
                    二、題目內容
                  </h6>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">題目</label>
                    <input type="text" class="form-control" id="liTopic" placeholder="請輸入標題...">
                  </div>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary required-star">語音內容 (腳本)</label>
                    <div id="q-listen-content"></div>
                  </div>

                  <div class="mb-4">
                    <label class="form-label fw-bold small text-secondary">附檔 (音檔/圖片)</label>
                    <div class="input-group">
                      <input class="form-control" type="file" id="liAttachment">
                    </div>
                    <div class="form-text small mt-1 text-primary d-none" id="liAttachmentName"></div>
                  </div>

                  <label class="form-label fw-bold small text-secondary mb-2">選項與正確答案</label>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <label class="option-header-styled" for="liRadioA">
                          <span class="badge bg-secondary">選項 A</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="liCorrectAnswer" value="A" id="liRadioA">
                            <span class="small fw-bold text-success">設為正確答案</span>
                          </div>
                        </label>
                        <div id="q-listen-optA" class="option-editor border-0"></div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <label class="option-header-styled" for="liRadioB">
                          <span class="badge bg-secondary">選項 B</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="liCorrectAnswer" value="B" id="liRadioB">
                            <span class="small fw-bold text-success">設為正確答案</span>
                          </div>
                        </label>
                        <div id="q-listen-optB" class="option-editor border-0"></div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <label class="option-header-styled" for="liRadioC">
                          <span class="badge bg-secondary">選項 C</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="liCorrectAnswer" value="C" id="liRadioC">
                            <span class="small fw-bold text-success">設為正確答案</span>
                          </div>
                        </label>
                        <div id="q-listen-optC" class="option-editor border-0"></div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card option-card h-100">
                        <label class="option-header-styled" for="liRadioD">
                          <span class="badge bg-secondary">選項 D</span>
                          <div class="form-check m-0">
                            <input class="form-check-input" type="radio" name="liCorrectAnswer" value="D" id="liRadioD">
                            <span class="small fw-bold text-success">設為正確答案</span>
                          </div>
                        </label>
                        <div id="q-listen-optD" class="option-editor border-0"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="p-3 bg-white border rounded mb-4 shadow-sm">
                  <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">
                    <i class="bi bi-lightbulb me-2"></i>
                    三、詳解與解析
                  </h6>

                  <div class="mb-3">
                    <label class="form-label fw-bold small text-secondary">解析 (紀錄答案理由)</label>
                    <div id="q-listen-explanation"></div>
                  </div>

                  <div id="div-ref-answer" class="mb-3 d-none">
                    <label class="form-label fw-bold small text-secondary required-star">參考答案 (難度五必填)</label>
                    <div id="q-listen-ref-answer"></div>
                  </div>
                </div>
              </div>

            </div>
          </form>
        </div>

        <div class="modal-footer border-top-0">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-outline-primary" id="btnSaveDraft" onclick="saveProp('草稿')">存為草稿</button>
          <button type="button" class="btn btn-primary fw-bold" id="btnSaveConfirm"
            onclick="saveProp('已確認')">儲存並確認</button>
        </div>

      </div>
    </div>
  </div>
  <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1060;">
    <div id="liveToast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive"
      aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // 1. 抓取表格 tbody 內的所有列
      // 注意：這裡直接抓 tbody 裡的 tr，避免抓到 header
      const rows = document.querySelectorAll('tbody tr');

      rows.forEach((row, index) => {
        // 2. 找到「狀態」那個欄位 (第 6 欄)
        // 為了避免算錯格，我們直接找裡面的 .badge
        const badge = row.querySelector('.badge');

        if (badge) {
          // 去除前後空白，確保比對正確
          const statusText = badge.innerText.trim();
          // 3. 判斷是否為「已傳送」
          if (statusText === '已傳送') {

            // A. 加上鎖定樣式 class
            row.classList.add('row-locked');

            // B. 真的把 checkbox 停用 (防止全選時被選中)
            const checkbox = row.querySelector('input[type="checkbox"]');
            if (checkbox) {
              checkbox.disabled = true;
            }
          }
        }
      });

      // 4. 修正全選功能
      // (確保全選時，不會勾到已鎖定的項目)
      const selectAllBtn = document.getElementById('selectAll');
      if (selectAllBtn) {
        selectAllBtn.addEventListener('change', function () {
          const isChecked = this.checked;
          const allCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');

          allCheckboxes.forEach(cb => {
            // 只有「沒有被 disabled」的才跟著全選
            if (!cb.disabled) {
              cb.checked = isChecked;
            }
          });
        });
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/sweetalert2.min.js"></script>
  <script src="js/quill.min.js"></script>
  <script src="js/General.js"></script>
  <script src="js/Reading.js"></script>
  <script src="js/LongArticle.js"></script>
  <script src="js/ShortArticle.js"></script>
  <script src="js/Listen.js"></script>
  <script src="js/app.js"></script>
</body>

</html>