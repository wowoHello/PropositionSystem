<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CWT 命題工作平臺</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/quill.snow.css">
  <link rel="stylesheet" href="css/sweetalert2.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap"
    rel="stylesheet" />
  <style>
    #viewModalContent img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
      /* 選用：讓圖片稍微圓角比較好看 */
    }

    /* 倒數/截止 (命題與審題的自動倒數)：紅色 */
    .border-red {
      border-left-color: #dc2626 !important;
    }

    /* 系統公告：橘色 */
    .border-orange {
      border-left-color: #f97316 !important;
    }

    /* 命題公告：藍色 */
    .border-blue {
      border-left-color: #2563eb !important;
    }

    /* 審題公告：綠色 */
    .border-green {
      border-left-color: #16a34a !important;
    }

    /* 其他：灰色 */
    .border-gray {
      border-left-color: #6b7280 !important;
    }

    /* 凍結區樣式 */
    #reminderFixedList {
      padding: 1.5rem 1.5rem 0.5rem 1.5rem;
      /* 上左右留白 */
      border-bottom: 1px dashed #e5e7eb;
      /* 虛線分隔，讓凍結感更明顯 */
    }

    /* 滾動條美化 (讓它看起來細一點，比較精緻) */
    #reminderScrollList::-webkit-scrollbar {
      width: 6px;
    }

    #reminderScrollList::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    #reminderScrollList::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }

    #reminderScrollList::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    html,
    body {
      height: 100%;
      overflow-x: hidden;
    }

    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #f3f4f6;
      display: flex;
      flex-direction: column;
    }

    .main-content {
      flex-grow: 1;
      padding: 2rem 0;
      display: flex;
      flex-direction: column;
    }

    .content-container {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .feature-card {
      background: white;
      border-top: 4px solid #2563eb;
      border-radius: 16px;
      height: 100%;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .card-body-custom {
      flex-grow: 1;
      display: flex;
      padding: 1.5rem;
      align-items: center;
    }

    .layout-standard .card-icon-wrapper {
      width: 35%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
    }

    .layout-standard .card-text-wrapper {
      width: 65%;
      padding-left: 1rem;
    }

    .layout-vertical {
      flex-direction: column;
    }

    .layout-vertical .card-body-custom {
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      height: 100%;
      padding: 1.5rem;
    }

    .layout-vertical .card-icon-wrapper {
      width: 100%;
      height: auto;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1.25rem;
      padding-bottom: 0;
    }

    .layout-vertical .card-text-wrapper {
      width: 100%;
      height: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .card-icon {
      width: 100%;
      height: 100%;
      max-height: 100px;
      object-fit: contain;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.75rem;
      line-height: 1.3;
    }

    .card-features {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .card-features li {
      font-size: 0.95rem;
      color: #4b5563;
      font-weight: 500;
      line-height: 1.8;
    }

    .layout-standard .card-features li::before {
      content: "•";
      color: #1f2937;
      margin-right: 0.5rem;
    }

    .layout-vertical .card-features li {
      display: inline-block;
      font-size: 0.9rem;
    }

    .layout-vertical .card-features li:not(:last-child)::after {
      content: "•";
      margin: 0 0.5rem;
      color: #cbd5e1;
    }

    .card-footer-action {
      padding: 1.2rem;
      background: white;
      border-top: 1px solid #f3f4f6;
    }

    .btn-gradient-shine {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      color: white;
      border: none;
      padding: 0.875rem 2rem;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .btn-gradient-shine::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent);
      transition: left 0.5s;
    }

    .btn-gradient-shine:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35);
    }

    .btn-gradient-shine:hover::before {
      left: 100%;
    }

    .reminder-card {
      background: white;
      border-radius: 16px;
      height: 100%;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .reminder-header {
      background-color: #2563eb;
      color: white;
      padding: 1.25rem 1.5rem;
      border-radius: 16px 16px 0 0;
      flex-shrink: 0;
    }

    .reminder-title {
      font-size: 1.125rem;
      font-weight: 700;
      margin: 0;
    }

    .reminder-body {
      padding: 1.5rem;
      flex-grow: 1;
      overflow-y: auto;
    }

    /* [今日提醒] 列表項目樣式優化 */
    .reminder-item {
      background-color: #fff;
      padding: 1rem 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.2s ease;
      border: 1px solid #eee;
      /* 預設細邊框 */
      border-left-width: 5px !important;
      /* 左側加粗 */
      cursor: default;
    }

    /* 只有「可點擊」的項目才有懸浮效果 */
    .reminder-item.is-clickable:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      background-color: #fafafa;
      /* 微調：懸浮時稍微變灰，增加回饋感 */
    }

    /* 若是公告類，滑鼠游標變成手指 */
    .reminder-item.is-clickable {
      cursor: pointer;
    }

    .reminder-item.is-clickable:active {
      background-color: #f9fafb;
      transform: translateY(0);
    }

    /* === [新增] 倒數提醒專屬樣式 (不可點擊) === */
    .reminder-item.is-countdown {
      background-color: #fff1f2;
      /* 極淡紅色背景，突顯警示感 */
      border: 1px solid #fecaca;
      /* 邊框帶紅 */
      /* 移除陰影，讓它看起來比較扁平、像是一個固定的 Dashboard 資訊 */
      box-shadow: none;
    }

    /* 確保倒數提醒滑鼠滑過時「不會動」 */
    .reminder-item.is-countdown:hover {
      transform: none;
      box-shadow: none;
    }

    .reminder-item div {
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* 內容文字樣式 */
    .reminder-content h6 {
      margin: 0;
      font-weight: 600;
      color: #374151;
      font-size: 1rem;
    }

    .reminder-meta {
      font-size: 0.85rem;
      color: #6b7280;
      margin-top: 6px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px 8px;
      line-height: 1.4;
    }

    .reminder-meta>span {
      display: inline-flex;
      align-items: center;
      white-space: nowrap;
      /* 保持「徽章內部文字」不換行，但徽章整體可以換行 */
    }

    @media (min-width: 992px) and (max-width: 1199px) {
      .card-body-custom {
        padding: 1.25rem 1rem;
      }

      .card-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }

      .card-features li {
        font-size: 0.875rem;
        line-height: 1.7;
      }

      .card-icon {
        max-height: 80px;
      }

      .btn-gradient-shine {
        padding: 0.75rem;
        font-size: 0.875rem;
      }

      .card-footer-action {
        padding: 1rem;
      }
    }

    @media (min-width: 1200px) {
      .card-title {
        font-size: 1.35rem;
      }

      .card-features li {
        font-size: 1rem;
      }
    }

    @media (min-width: 1400px) {
      .main-content {
        padding: 2.5rem 0;
      }

      .card-body-custom {
        padding: 2rem 1.5rem;
      }

      .card-title {
        font-size: 1.5rem;
      }

      .card-features li {
        font-size: 1.05rem;
      }
    }

    @media (max-width: 991px) {
      .layout-standard .card-body-custom {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem;
      }

      .layout-standard .card-icon-wrapper {
        width: 100%;
        margin-bottom: 1rem;
      }

      .layout-standard .card-text-wrapper {
        width: 100%;
        padding-left: 0;
      }

      .layout-standard .card-features {
        display: inline;
      }

      .layout-standard .card-features li {
        display: inline-block;
      }

      .layout-standard .card-features li::before {
        content: "";
        margin-right: 0;
      }

      .layout-standard .card-features li:not(:last-child)::after {
        content: "•";
        margin: 0 0.5rem;
        color: #cbd5e1;
      }
    }
  </style>
</head>

<body>
  <nav class="top-navbar">
    <div class="container-fluid px-4">
      <div class="row align-items-center">
        <div class="col-3">
          <a href="firstpage.html" class="navbar-brand">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
            </svg>
            CWT 命題工作平臺
          </a>
        </div>

        <!-- 中間：專案切換器 -->
        <div class="col-6 d-flex justify-content-center">
          <div class="project-switcher">
            <div class="project-display glass-enhanced" id="projectToggle">
              <div class="glass-icon">
                <img src="ICON/calendar.svg" alt="Calendar" style="width: 24px; height: 24px;">
              </div>

              <div class="project-info">
                <div class="project-year" id="currentProjectYear">
                  2024年度
                </div>
                <div class="project-name" id="currentProjectName">
                  進行中梯次範例一
                </div>
              </div>
              <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z" />
              </svg>
            </div>

            <div class="project-dropdown" id="projectDropdown">
              <div class="dropdown-header">
                <span>切換專案</span>
                <button class="close-btn" id="closeDropdown">
                  <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path
                      d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
                  </svg>
                </button>
              </div>

              <div class="project-search">
                <input type="text" placeholder="搜尋專案名稱..." id="projectSearchInput" />
              </div>

              <div class="project-list" id="projectList">
                <div class="project-category">進行中 (3)</div>

                <div class="project-item active" data-project-id="1" data-year="2024" data-name="進行中梯次範例一"
                  data-role="admin">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例一
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2024/12/31</span>
                    </div>
                  </div>
                  <span class="role-badge role-admin">系統管理員</span>
                </div>

                <div class="project-item" data-project-id="2" data-year="2024" data-name="進行中梯次範例二"
                  data-role="reviewer">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例二
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2024/11/15</span>
                    </div>
                  </div>
                  <span class="role-badge role-reviewer">審題委員</span>
                </div>

                <div class="project-item" data-project-id="3" data-year="2024" data-name="進行中梯次範例三" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-active"></span>
                      進行中梯次範例三
                    </div>
                    <div class="project-item-meta">
                      <span>2024年度</span>
                      <span>截止: 2025/01/20</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-category">已結束 (5)</div>

                <div class="project-item" data-project-id="4" data-year="2023" data-name="已結束梯次範例一" data-role="admin">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例一
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-admin">系統管理員</span>
                </div>

                <div class="project-item" data-project-id="5" data-year="2023" data-name="已結束梯次範例二" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例二
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-item" data-project-id="6" data-year="2023" data-name="已結束梯次範例三"
                  data-role="reviewer">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例三
                    </div>
                    <div class="project-item-meta">
                      <span>2023年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-reviewer">審題委員</span>
                </div>

                <div class="project-item" data-project-id="7" data-year="2022" data-name="已結束梯次範例四" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例四
                    </div>
                    <div class="project-item-meta">
                      <span>2022年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>

                <div class="project-item" data-project-id="8" data-year="2022" data-name="已結束梯次範例五" data-role="teacher">
                  <div class="project-item-info">
                    <div class="project-item-title">
                      <span class="status-indicator status-finished"></span>
                      已結束梯次範例五
                    </div>
                    <div class="project-item-meta">
                      <span>2022年度</span>
                      <span>已結束</span>
                    </div>
                  </div>
                  <span class="role-badge role-teacher">命題教師</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 右側：使用者資訊 -->
        <div class="col-3">
          <div class="user-section">
            <div class="user-info">
              <div class="user-avatar">沈</div>
              <span class="user-name">沈雅茹</span>
              <span class="role-badge role-admin" id="currentUserRole">系統管理員</span>
            </div>
            <a href="index.html" class="btn btn-sm btn-light fw-bold text-primary px-3">登出</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="main-content">
    <div class="container-fluid px-4 content-container">
      <div class="row g-4 h-100">
        <div class="col-lg-9 d-flex flex-column gap-4">
          <div class="row g-4 flex-grow-1">
            <!-- 命題儀錶板 -->
            <div class="col-md-4">
              <div class="feature-card layout-standard">
                <div class="card-body-custom">
                  <div class="card-icon-wrapper">
                    <img src="ICON/001.png" alt="Icon" class="card-icon" />
                  </div>
                  <div class="card-text-wrapper">
                    <h3 class="card-title">命題儀錶板</h3>
                    <ul class="card-features">
                      <li>掌握命題進度</li>
                      <li>題型缺口</li>
                      <li>逾期警示</li>
                      <li>稽核歷程</li>
                    </ul>
                  </div>
                </div>
                <div class="card-footer-action text-center">
                  <a href="cwt-dashboard.html" class="btn-gradient-shine d-inline-block text-decoration-none px-5">
                    進入儀表板
                  </a>
                </div>
              </div>
            </div>
            <!-- 命題專案管理 -->
            <div class="col-md-4">
              <div class="feature-card layout-standard">
                <div class="card-body-custom">
                  <div class="card-icon-wrapper">
                    <img src="ICON/007.png" alt="Icon" class="card-icon" />
                  </div>
                  <div class="card-text-wrapper">
                    <h3 class="card-title">命題專案管理</h3>
                    <ul class="card-features">
                      <li>新增/編輯專案</li>
                      <li>梯次區間設定</li>
                      <li>專案人員指派</li>
                      <li>狀態與期限管理</li>
                    </ul>
                  </div>
                </div>
                <div class="card-footer-action text-center">
                  <a href="cwt-prop.html" class="btn-gradient-shine d-inline-block text-decoration-none px-5">進入專案管理</a>
                </div>
              </div>
            </div>
            <!-- 我的命題任務 -->
            <div class="col-md-4">
              <div class="feature-card layout-standard">
                <div class="card-body-custom">
                  <div class="card-icon-wrapper">
                    <img src="ICON/002.png" alt="Icon" class="card-icon" />
                  </div>
                  <div class="card-text-wrapper">
                    <h3 class="card-title">我的命題任務</h3>
                    <ul class="card-features">
                      <li>命製試題</li>
                      <li>修正試題</li>
                      <li>截止提醒</li>
                    </ul>
                  </div>
                </div>
                <div class="card-footer-action text-center">
                  <a href="cwt-list.html" class="btn-gradient-shine d-inline-block text-decoration-none px-5">進入命題任務</a>
                </div>
              </div>
            </div>
            <!-- 審題清單 -->
            <div class="col-md-4">
              <div class="feature-card layout-standard">
                <div class="card-body-custom">
                  <div class="card-icon-wrapper">
                    <img src="ICON/003.png" alt="Icon" class="card-icon" />
                  </div>
                  <div class="card-text-wrapper">
                    <h3 class="card-title">審題清單</h3>
                    <ul class="card-features">
                      <li>查看待審題目</li>
                      <li>採用</li>
                      <li>不採用</li>
                      <li>改後採用</li>
                    </ul>
                  </div>
                </div>
                <div class="card-footer-action text-center">
                  <a class="btn-gradient-shine d-inline-block text-decoration-none px-5">進入審題</a>
                </div>
              </div>
            </div>
            <!-- 角色與權限管理 -->
            <div class="col-md-4">
              <div class="feature-card layout-standard">
                <div class="card-body-custom">
                  <div class="card-icon-wrapper">
                    <img src="ICON/004.png" alt="Icon" class="card-icon" />
                  </div>
                  <div class="card-text-wrapper">
                    <h3 class="card-title">角色與權限管理</h3>
                    <ul class="card-features">
                      <li>帳號管理</li>
                      <li>角色設定</li>
                      <li>權限控管</li>
                      <li>導頁規則設定</li>
                    </ul>
                  </div>
                </div>
                <div class="card-footer-action text-center">
                  <a href="cwt-role.html" class="btn-gradient-shine d-inline-block text-decoration-none px-5">進入管理</a>
                </div>
              </div>
            </div>
            <!-- 系統公告 / 使用說明 -->
            <div class="col-md-4">
              <div class="feature-card layout-vertical">
                <div class="card-body-custom">
                  <div class="card-icon-wrapper">
                    <img src="ICON/005.png" alt="Icon" class="card-icon" />
                  </div>
                  <div class="card-text-wrapper">
                    <h3 class="card-title">系統公告 / 使用說明</h3>
                    <ul class="card-features">
                      <li>系統公告</li>
                      <li>操作手冊</li>
                      <li>常見問題</li>
                    </ul>
                  </div>
                </div>
                <div class="card-footer-action text-center">
                  <a href="cwt-announcement.html"
                    class="btn-gradient-shine d-inline-block text-decoration-none px-5">查看公告</a>
                </div>
              </div>
            </div>
            <!-- 教師管理系統 -->
            <div class="col-md-4">
              <div class="feature-card layout-standard">
                <div class="card-body-custom">
                  <div class="card-icon-wrapper">
                    <img src="ICON/006.png" alt="Icon" class="card-icon" />
                  </div>
                  <div class="card-text-wrapper">
                    <h3 class="card-title">教師管理系統</h3>
                    <ul class="card-features">
                      <li>教師名單維護</li>
                      <li>任教背景檢視</li>
                      <li>命題參與歷程</li>
                      <li>篩選與查詢</li>
                    </ul>
                  </div>
                </div>
                <div class="card-footer-action text-center">
                  <a href="cwt-teacher.html"
                    class="btn-gradient-shine d-inline-block text-decoration-none px-5">進入教師管理</a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 今日提醒 -->
        <div class="col-lg-3">
          <div class="reminder-card" style="position: sticky; top: 90px; height: calc(90vh - 90px);">
            <div class="reminder-header d-flex justify-content-between align-items-center">
              <h3 class="reminder-title mb-0">今日提醒</h3>
              <div class="bg-white rounded-pill px-2 py-1 border d-flex align-items-center shadow-sm"
                style="width: fit-content;">

                <span class="text-muted d-flex align-items-center me-2 border-end pe-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-type"
                    viewBox="0 0 16 16">
                    <path
                      d="m2.244 13.081.943-2.803H6.66l.944 2.803H8.86L5.54 3.75H4.322L1 13.081zm2.7-7.923L6.34 9.314H3.51l1.4-4.156zm9.146 7.027h.035v.896h1.128V8.125c0-1.51-1.114-2.345-2.646-2.345-1.736 0-2.59.916-2.666 2.174h1.108c.068-.718.595-1.19 1.517-1.19.971 0 1.518.52 1.518 1.464v.731H12.19c-1.647.007-2.522.8-2.522 2.058 0 1.319.957 2.18 2.345 2.18 1.06 0 1.716-.43 2.078-1.011zm-1.763.035c-.752 0-1.456-.397-1.456-1.244 0-.65.424-1.115 1.408-1.115h1.805v.834c0 .896-.752 1.525-1.757 1.525" />
                  </svg>
                </span>

                <button
                  class="btn btn-sm bg-transparent border-0 p-0 rounded-circle d-flex align-items-center justify-content-center hover-effect"
                  style="width: 28px; height: 28px; transition: transform 0.1s;" onclick="changeFontSize(-1)"
                  title="縮小">
                  <img src="ICON/minus.png" alt="縮小" style="width: 24px; height: auto;">
                </button>

                <span class="small fw-bold text-secondary mx-1 user-select-none"
                  style="cursor: pointer; min-width: 40px; text-align: center; transition: color 0.3s;"
                  onclick="resetFontSize()" id="fontSizeDisplay" title="點擊還原預設值">
                  100%
                </span>

                <button
                  class="btn btn-sm bg-transparent border-0 p-0 rounded-circle d-flex align-items-center justify-content-center hover-effect"
                  style="width: 28px; height: 28px; transition: transform 0.1s;" onclick="changeFontSize(1)" title="放大">
                  <img src="ICON/add.png" alt="放大" style="width: 24px; height: auto;">
                </button>
              </div>
            </div>
            <div class="d-flex flex-column" style="flex-grow: 1; overflow: hidden; position: relative;">

              <div id="reminderFixedList" class="bg-white"
                style="z-index: 10; flex-shrink: 0; box-shadow: 0 4px 6px -4px rgba(0,0,0,0.1);">
              </div>

              <div id="reminderScrollList" class="flex-grow-1"
                style="overflow-y: auto; padding: 1.5rem 1.5rem 0.5rem 1.5rem;">
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="viewAnnouncementModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content border-0 shadow">
        <div class="modal-header text-white" id="modalHeaderBg">
          <h5 class="modal-title fw-bold" id="viewModalTitle">公告標題</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">
          <div id="viewModalMetaBox"
            class="p-3 rounded-3 mb-4 d-flex justify-content-between align-items-center shadow-sm"
            style="background-color: #f8fafc; border: 1px solid #e2e8f0; border-left: 5px solid #64748b;">

            <div class="d-flex align-items-center gap-2">
              <span class="badge bg-danger shadow-sm fs-6 fw-normal d-none" id="viewModalPinned">
                <i class="bi bi-pin-angle-fill me-1"></i>置頂
              </span>
              <span class="badge shadow-sm fs-6 fw-normal" id="viewModalCategory" style="background-color: #64748b;">
                <i class="bi bi-tag-fill me-1"></i>分類
              </span>
            </div>

            <div class="d-flex align-items-center text-secondary small fw-bold bg-white px-3 py-1 rounded-pill border">
              <i class="bi bi-calendar3 me-2 text-primary"></i>
              <span id="viewModalDate" style="letter-spacing: 0.5px;">2026-01-20</span>
            </div>
          </div>

          <div class="px-1 text-dark text-opacity-75 ql-editor" style="line-height: 1.8; font-size: 1.05rem;"
            id="viewModalContent">
            公告內容...
          </div>
        </div>
        <div class="modal-footer bg-light border-0">
          <button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">關閉</button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script src="js/sweetalert2.min.js"></script>
  <script src="js/app.js"></script>
  <script>
    const styleConfig = {
      '系統公告': { border: 'border-orange', icon: 'bi-megaphone-fill', color: '#f97316', label: '系統公告' },
      '命題公告': { border: 'border-blue', icon: 'bi-pencil-square', color: '#2563eb', label: '命題公告' },
      '審題公告': { border: 'border-green', icon: 'bi-check-circle-fill', color: '#16a34a', label: '審題公告' },
      '其他': { border: 'border-gray', icon: 'bi-info-circle-fill', color: '#6b7280', label: '其他' },
      'countdown': { border: 'border-red', icon: 'bi-alarm-fill', color: '#dc2626', label: '截止提醒' }
    };

    const mockDeadlines = [
      { type: 'countdown', title: '【命題】115年冬季大會考', date: '2026-01-25', daysLeft: 3 },
      { type: 'countdown', title: '【審題】115年冬季大會考', date: '2026-01-28', daysLeft: 6 },
    ];

    function createReminderItem(item) {
      let styleKey = '其他';
      if (item.type === 'countdown') styleKey = 'countdown';
      else if (item.originalCategory) styleKey = item.originalCategory;

      const style = styleConfig[styleKey] || styleConfig['其他'];
      const isClickable = item.type === 'announcement';
      const isCountdown = item.type === 'countdown';

      const div = document.createElement('div');
      div.className = `reminder-item ${style.border} ${isClickable ? 'is-clickable' : ''} ${isCountdown ? 'is-countdown' : ''}`;

      let metaHtml = '';
      if (isCountdown) {
        metaHtml = `<span class="fw-bold text-danger">剩餘 ${item.daysLeft} 天</span>`;
      } else {
        // 加上 "截止：" 標示，讓使用者知道這是截止日期
        metaHtml = `<span class="text-secondary small"><i class="bi bi-hourglass-split me-1"></i>截止：${item.date}</span>`;
      }

      const pinBadge = item.isPinned ? `<span class="badge bg-danger"><i class="bi bi-pin-angle-fill me-1"></i>置頂</span>` : '';

      const categoryBadge = isCountdown
        ? `<span class="text-secondary small"><i class="bi bi-calendar-event me-1"></i>截止：${item.date}</span>`
        : `<span class="badge border bg-white" style="color:${style.color}; border-color:${style.color}!important">${style.label}</span>`;

      const titleStyle = isCountdown ? 'font-weight:700; color:#b91c1c;' : '';

      // 凍結區(countdown) 不使用 text-truncate，以免手機版看不到完整標題
      const titleClass = isCountdown ? 'reminder-title text-wrap' : 'reminder-title text-truncate';

      div.innerHTML = `
            <div class="reminder-icon me-2">
                <i class="bi ${style.icon} fs-5" style="color: ${style.color};"></i>
            </div>
            <div class="flex-grow-1" style="min-width: 0;">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="${titleClass}" style="${titleStyle}">${item.title}</div>
                </div>
                <div class="reminder-meta">
                    ${pinBadge}
                    ${isCountdown ? '' : categoryBadge}
                    ${isCountdown ? categoryBadge : ''}
                    ${isCountdown ? '' : `<span>${metaHtml}</span>`}
                    ${isCountdown ? metaHtml : ''}
                </div>
            </div>
            ${isClickable ? '<i class="bi bi-chevron-right text-black-50 ms-2" style="font-size: 0.8rem;"></i>' : ''}
        `;

      if (isClickable) {
        div.onclick = () => openAnnouncementModal(item, style);
      }

      return div;
    }

    function renderReminders(projectId) {
      // 取得兩個容器
      const fixedContainer = document.getElementById('reminderFixedList');
      const scrollContainer = document.getElementById('reminderScrollList');

      // 清空容器
      fixedContainer.innerHTML = '';
      scrollContainer.innerHTML = '';

      // 1. 取得並整理資料
      let storedAnnouncements = [];
      const stored = localStorage.getItem("cwt_announcements");

      if (stored) {
        storedAnnouncements = JSON.parse(stored);
      } else {
        // If no localStorage, try to use mockAnnouncements from app.js
        storedAnnouncements = (typeof mockAnnouncements !== 'undefined') ? mockAnnouncements : [];
      }

      // [新增] 綁定梯次過濾邏輯
      // 如果沒有傳入 projectId，嘗試從 localStorage 獲取
      if (!projectId) {
        projectId = localStorage.getItem("cwt_active_project");
      }

      const announcements = storedAnnouncements
        .filter(a => {
          // 狀態必須是已發布
          if (a.status !== 'published') return false;

          // [核心邏輯] 梯次綁定過濾
          // 1. 如果公告是 'all' (全站通用)，則保留
          // 2. 如果公告指定的 boundProject 等於當前選中的 projectId，則保留
          // 注意：localStorage 存的可能是字串或數字，統一轉字串比對
          let currentProjId = projectId ? String(projectId) : "";
          let itemBound = a.boundProject ? String(a.boundProject) : "all";

          if (itemBound !== 'all') {
            if (!currentProjId) return false; // 如果當前沒選專案，只顯示通用
            return itemBound === currentProjId;
          }

          return true; // default (all)
        })
        .map(a => ({
          type: 'announcement',
          originalCategory: a.category,
          title: a.title,
          // 修正：原本 a.date 不存在，改顯示截止日期 (endDate)，若無則顯示 '無期限'
          date: a.endDate ? a.endDate : '無期限',
          content: a.content,
          id: a.id,
          isPinned: a.isPinned || false
        }));

      // 一般公告排序 (置頂 > 日期)
      announcements.sort((a, b) => {
        if (a.isPinned && !b.isPinned) return -1;
        if (!a.isPinned && b.isPinned) return 1;
        return new Date(b.date) - new Date(a.date);
      });

      // 倒數事項 (Mock Data)
      // 注意：Mock Data 這裡沒做 ID 綁定，暫時當作「全站通用」
      const deadlineItems = [...mockDeadlines];

      // 2. 渲染 [凍結區] - 紅色倒數項目
      if (deadlineItems.length > 0) {
        // 顯示倒數項目
        deadlineItems.forEach(item => {
          fixedContainer.appendChild(createReminderItem(item));
        });
      } else {
        // 如果沒有倒數項目，可以選擇隱藏凍結區，或顯示一段文字
        fixedContainer.style.display = 'none';
        // 或者是把 border 去掉，讓下面看起來比較順
        fixedContainer.style.borderBottom = 'none';
      }

      // 3. 渲染 [滾動區] - 所有一般公告 (不限制數量)
      if (announcements.length > 0) {
        announcements.forEach(item => {
          scrollContainer.appendChild(createReminderItem(item));
        });

        // 增加一個底部的空白，避免最後一個項目貼底太難看
        const spacer = document.createElement('div');
        spacer.style.height = '1rem';
        scrollContainer.appendChild(spacer);

      } else {
        scrollContainer.innerHTML = `
            <div class="d-flex flex-column align-items-center justify-content-center py-5 h-100 text-center opacity-75">
                <div class="mb-3 position-relative">
                    <div class="position-absolute top-50 start-50 translate-middle bg-secondary bg-opacity-10 rounded-circle" style="width: 60px; height: 60px;"></div>
                    <i class="bi bi-bell-slash text-secondary position-relative" style="font-size: 2rem;"></i>
                </div>
                <h6 class="fw-bold text-secondary mb-1">目前沒有新公告</h6>
            </div>
        `;
      }
    }

    function openAnnouncementModal(item, style) {
      document.getElementById('viewModalTitle').textContent = item.title;
      document.getElementById('viewModalDate').textContent = item.date;
      document.getElementById('viewModalContent').innerHTML = item.content;

      const header = document.getElementById('modalHeaderBg');
      header.style.backgroundColor = style.color;

      const badge = document.getElementById('viewModalCategory');
      badge.innerHTML = `<i class="bi ${style.icon} me-1"></i>${style.label}`;
      badge.style.backgroundColor = style.color;
      badge.style.color = '#fff';

      // Pinned Badge Logic
      const pinnedBadge = document.getElementById('viewModalPinned');
      if (pinnedBadge) {
        if (item.isPinned) {
          pinnedBadge.classList.remove('d-none');
        } else {
          pinnedBadge.classList.add('d-none');
        }
      }

      // [New] Dynamic Meta Box Styling
      const metaBox = document.getElementById('viewModalMetaBox');
      if (metaBox) {
        // Set accent border color
        metaBox.style.borderLeftColor = style.color;
        // Optional: Set a very subtle tinted background
        // Hex to RGBA conversion for 5% opacity background
        // Simple way: stick to nice gray, just color the border.
        // Or if you really want dynamic background:
        // metaBox.style.backgroundColor = style.color + '0D'; // approx 5% alpha if hex
      }

      new bootstrap.Modal(document.getElementById('viewAnnouncementModal')).show();
    }

    document.addEventListener('DOMContentLoaded', () => renderReminders());

    // [新增] 監聽專案切換事件
    document.addEventListener('projectChanged', (e) => {
      // e.detail 包含 { projectId, role }
      console.log('收到專案切換事件:', e.detail);
      renderReminders(e.detail.projectId);
    });
  </script>
</body>

</html>